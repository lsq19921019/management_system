webpackJsonp([67],{224:function(e,t,a){try{(function(){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var a=[],r=!0,n=!1,s=void 0;try{for(var o,l=e[Symbol.iterator]();!(r=(o=l.next()).done)&&(a.push(o.value),!t||a.length!==t);r=!0);}catch(e){n=!0,s=e}finally{try{!r&&l.return&&l.return()}finally{if(n)throw s}}return a}return function(t,a){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,a);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=a(2),o=r(s),l=a(1),i=a(8),u=a(9),d=(r(u),a(4)),c=r(d),f=a(14),m=r(f),p=a(13),h=r(p),y=a(5),E=r(y),v=a(11),g=(r(v),a(18)),b=r(g),w=a(6),S=(r(w),a(7)),T=(r(S),a(41)),k=r(T),N=o.default.createClass({displayName:"ImportForm",propTypes:{setTaskStore:s.PropTypes.func},getInitialState:function(){return{phoneInfo:null,unsupport:!1,showUnsupport:!1,isStart:!1,defaultPhone:"",Type:"password",bgImg:"url("+a(20)+")",frontConf:this.props.frontConf}},componentDidMount:function(){},componentWillUnmount:function(){this.unmount=!0},render:function(){var e=this,t=this.handleImport,a=this.handleLink,r=this.state,n=r.unsupport,s=r.showUnsupport,i=r.isStart,u=(r.defaultPhone,m.default.get("chsi",0,0,0)),d="";u&&u.loginParam&&(d=u.loginParam.phone);var c=s?o.default.createElement("div",{className:"carrier-unsupport"},o.default.createElement("i",null),o.default.createElement("p",null,n)):o.default.createElement("div",{className:"config-import-page"},o.default.createElement("div",{className:"form common-form"},o.default.createElement("div",{className:"input-item"},o.default.createElement(h.default,{type:"text",ref:"phone",id:"chsiMobile",placeholder:"邮箱/手机/身份证号",label:"学信网账号",defaultValue:d}),o.default.createElement("div",{onClick:function(){return e.clearValue("#chsiMobile")},className:"tex_box name"},o.default.createElement("span",{className:"textt"}))),o.default.createElement("div",{className:"input-item"},o.default.createElement(h.default,{type:this.state.Type,ref:"password",id:"chsiPassword",placeholder:"请输入密码",label:"密码"}),o.default.createElement("div",{onClick:this.showPwd,className:"tex_box"},o.default.createElement("span",{style:{backgroundImage:this.state.bgImg},className:"password password_show"})))),o.default.createElement(k.default,{ref:"agreementField",uid:"0",frontConf:this.state.frontConf}),o.default.createElement("div",{className:"page-wrapper"},o.default.createElement(E.default,{types:"full",onTap:t,disable:i,state:i,getState:function(e){switch(e){case!1:return"提交";case!0:return"登录中...";default:return"提交"}}})),o.default.createElement("div",{style:{color:l.qsParams.themeColor?"#"+l.qsParams.themeColor:"#5e82fb"},className:"link-wrapper"},o.default.createElement("div",{onClick:function(){a(1)}},o.default.createElement("span",{className:"ion-ios-redo-outline"}),o.default.createElement("a",null,"账号注册")),o.default.createElement("div",{onClick:function(){a(2)}},o.default.createElement("span",{className:"ion-ios-help-outline"}),o.default.createElement("a",null,"找回密码"))));return o.default.createElement("div",null,o.default.createElement(b.default,null,c))},clearValue:function(e){document.querySelector(e).parentNode.querySelector("input").value=""},showPwd:function(){"text"==this.state.Type?this.setState({Type:"password",bgImg:"url("+a(20)+")"}):this.setState({Type:"text",bgImg:"url("+a(36)+")"})},handleImport:function(){var e=this,t=this.props.onSubmitTaskDone;if(this.state.phoneInfo,!this.refs.agreementField.isChecked(T.AGREEMENT_TYPE.MOXIE))return void setTimeout(function(){return c.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs.agreementField.isChecked(T.AGREEMENT_TYPE.TENANT))return void setTimeout(function(){return c.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs.phone.getValue())return void setTimeout(function(){return c.default.alert("请输入正确的学信网账号","")});if(!this.refs.password.getValue())return void setTimeout(function(){return c.default.alert("请输入学信网密码","")});this.setState({isStart:!0});var a=this.refs.phone.getValue(),r=this.refs.password.getValue(),n=void 0;(0,i.submitTaskHelper)({taskType:"chsi",taskSubType:"",username:a,password:r}).then(function(r){if(n=r,r.body.task_id){e.setState({isStart:!1}),c.default.refreshStatus("2","创建任务成功"),c.default.mxSaveTaskId(r.body.task_id);var s={taskId:r.body.task_id,username:a,taskType:"chsi",loginParam:{phone:a}};t(s),m.default.set("email",0,0,0,{loginParam:{username:a}})}}).catch(function(t){e.setState({isStart:!1}),console.log(t);var a=t&&t.body||{};a.errors&&a.errors[0]&&(10220011===a.errors[0].code||10220012===a.errors[0].code)?(c.default.refreshStatus("-2",a.errors[0].message),e.showUnsupport(a.errors[0].message)):(c.default.refreshStatus("-3","服务异常，创建任务失败"),e.handleError(t,a.detail))})},handleError:function(e){var t=arguments.length<=1||void 0===arguments[1]?"任务提交失败":arguments[1];try{t=e&&e.body&&e.body.detail||t}catch(e){}if("任务提交失败"==t){if(e&&e.message&&e.message.indexOf("the network is offline")!=-1)return void c.default.alert("网络开小差啦，请稍后再试");c.default.alert(t+"\n"+e)}else c.default.alert(t);this.setState({isStart:!1})},handleLink:function(e){switch(e){case 1:c.default.openWebView("注册","https://account.chsi.com.cn/account/preregister.action?from=chsi-home","","");break;case 2:c.default.openWebView("忘记密码","https://account.chsi.com.cn/account/password!retrive","","")}},handleForgetSMS:function(e){var t=n(e,3),a=t[0],r=t[1],s=t[2];c.default.confirm(r,"","取消,发送",function(e){2==e&&((0,l.isIOS)()?window.location.href="sms:"+s+"&body="+a:window.location.href="sms:"+s+"?body="+a)})},onSubmitTaskDone:function(e){return e.importResult={},this.props.onSubmitTaskDone(e),!0},showUnsupport:function(e){this.setState({unsupport:e||this.state.unsupport,showUnsupport:!0})}});t.default=N,e.exports=t.default}).call(this)}finally{}}});