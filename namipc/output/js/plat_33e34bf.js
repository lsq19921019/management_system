!function(){var t=require("mod/tools"),a=t.apiUrl(),e={init:function(){e.getSearchOption(),e.getFinanceList(),e.getBtnClick(),e.pageClick()},getSearchOption:function(){var e=function(t){var a=[];for(var e in t){var n={};for(var i in t[e])n.key=i,n.value=t[e][i];a.push(n)}return a};t.fetchAjax(a.data+"/finance/query_criteria").done(function(a){if(0==a.status){var n=e(a.result&&a.result.annualized),i=e(a.result&&a.result.deadline);(a.result&&a.result.list).unshift({pfname:"不限"});var r=a.result.list;t.renderTpl($(".search-section .ann-hbs"),$("#ann-template"),{annualized:n}),t.renderTpl($(".search-section .deadline-hbs"),$("#deadline-template"),{deadline:i}),t.renderTpl($(".search-section .company-hbs"),$("#company-template"),{companyList:r})}})},getFinanceList:function(n,i,r){var s=$("body").attr("class").indexOf("plat")>-1?"0":"1",l={type:n||1,projectRange:s,value:i||"",pageNum:r||1};t.fetchAjax(a.data+"/finance/project_list",l).done(function(a){if("0"===a.status||0===a.status){console.log(a);var n=a.result&&a.result.list||[];t.renderTpl($(".recommend-section .recommend-box"),$("#recommend-box-template"),{recommendList:n}),n.length?$(".null-tips").hide():$(".null-tips").show();var i=a.result&&a.result.pageEntity;e.setPageDate(i)}}).fail(function(t){console.log(t)})},getBtnClick:function(){var t=$(".search-section"),a=$(".sort-section");t.on("click","a",function(){var n=$(this);t.find("a").removeClass("active"),t.find("a.first").addClass("active"),a.find("a").removeClass("active"),a.find("a.first").addClass("active");var i=n.parents(".search-item");i.find("a").removeClass("active"),n.addClass("active");var r=n.attr("data-type"),s=n.attr("data-key");$("body").attr("data-type",r),$("body").attr("data-key",s),e.getFinanceList(r,s)}),a.on("click","a",function(){var n=$(this);t.find("a").removeClass("active"),t.find("a.first").addClass("active"),a.find("a").removeClass("active"),n.addClass("active");var i=n.attr("data-type"),r=n.attr("data-key");$("body").attr("data-type",i),$("body").attr("data-key",r),e.getFinanceList(i,r)})},setPageDate:function(t){var a=$(".page-list");t.totalPage>1?a.show():a.hide(),a.attr("data-totalPage",t.totalPage),a.find(".all").text("共"+t.totalCount+"条"),a.find(".cur-page").text(t.currentPage+"/"+t.totalPage)},pageClick:function(){var t=$(".page-list");t.on("click","a",function(){var a=1,n=1*t.find(".cur-page").text().split("/")[0],i=1*t.find(".cur-page").text().split("/")[1],r=$(this).attr("data-page");"first"===r?a=1:"prev"===r?a=n-1>0?n-1:1:"next"===r?a=i>n+1?n+1:i:"end"===r&&(a=t.attr("data-totalPage"));var s=$("body").attr("data-type")||"",l=$("body").attr("data-key")||"";e.getFinanceList(s,l,1*a)})}};e.init()}();