webpackJsonp([22,41],{61:function(e,t,a){e.exports=a.p+"assets/dce45f5d.download.gif"},62:function(e,t,a){e.exports=a.p+"assets/a44566d4.invalid.png"},112:function(e,t,a){t=e.exports=a(93)(!1),t.push([e.id,".input-items-box{border-bottom:1px solid #ededed;padding-left:10px;background-color:#fff}.input-items{position:relative;padding:0;height:45px}.input-items,.input-items .mx-input{box-sizing:border-box;display:-webkit-box;display:-webkit-flex;display:-moz-flex;display:-ms-flexbox;display:flex}.input-items .mx-input{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-moz-flex:1;-ms-flex:1;flex:1}.input-items .mx-input label{height:43px;min-width:70px;font-size:13px;margin-top:auto;margin-bottom:auto}.input-items .mx-input .mx-input-main{height:49px}.input-items .mx-input .mx-input-main,.input-items .mx-input input{-webkit-box-flex:1;-webkit-flex:1;-moz-box-flex:1;-moz-flex:1;-ms-flex:1;flex:1;box-sizing:border-box}.input-items .mx-input input{font-size:14px;border:none;outline:none;height:43px;position:relative;display:block;width:100%}.input-items .input-item-tips{font-size:11px;color:#666;padding-bottom:10px}.log-right{color:#d9d9d9}.log-right,.log-wrong{font-size:11px;padding-bottom:5px;margin-left:5px}.log-wrong{color:#f17283}",""])},118:function(e,t,a){var n=a(112);"string"==typeof n&&(n=[[e.id,n,""]]);var s,i={};i.transform=s,a(99)(n,i),n.locals&&(e.exports=n.locals)},144:function(e,t,a){e.exports=a.p+"assets/c074743e.bankScanCode.jpg"},145:function(e,t,a){e.exports=a.p+"assets/35417770.zhiyinStep1.jpg"},222:function(e,t,a){try{(function(){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var s=a(2),i=n(s),r=a(8),o=a(14),l=n(o),u=a(1),p=a(40),d=a(4),c=n(d),m=a(164),g=n(m),f=a(10),h=n(f),y=a(13),x=n(y),_=a(5),v=n(_),E=a(11),k=(n(E),a(41)),w=n(k),b=a(12),C=n(b);a(118);var T="#58B5EB",N="https://api.51datakey.com/h5/static/bank_icon/bank_icon_{bankMark}.png",I=i.default.createClass({displayName:"ImportForm",getInitialState:function(){return{loginTypeIndex:0,login:!0,Type:"password",bgImg:"url("+a(20)+")",qrcodeTimeout:!1,qrcodeValue:null,showQRCodeInstruction:!1,gettingCode:!1,cardType:this.props.cardType,bankId:this.props.bankId,frontConf:this.props.frontConf,isRight0:!0,isRight1:!0,isRight2:!0}},componentDidMount:function(){var e=this;this.onSubmitTaskDone,document.activeElement&&document.activeElement.blur();var t=this.props,a=t.pageConfig,n=(t.poll,(0,p.getParams)("loginParams"));n&&"undefined"!=n&&n[a.login_type]&&(n[a.login_type].username&&n[a.login_type].password&&!n[a.login_type].username1||n[a.login_type].username1&&n[a.login_type].username&&n[a.login_type].password)&&(this.timer=setInterval(function(){n[a.login_type].username1?""!=e.refs[a.login_type+"input0"].getValue()&&""!=e.refs[a.login_type+"input1"].getValue()&&""!=e.refs[a.login_type+"input2"].getValue()&&(clearInterval(e.timer),e.handleImport()):""!=e.refs[a.login_type+"input0"].getValue()&&""!=e.refs[a.login_type+"input2"].getValue()&&(clearInterval(e.timer),e.handleImport())},100)),"QRCODE"==a.login_type,this.isMounted=!0;var s=0;this.setState({loginTypeIndex:s})},componentWillUnmount:function(){this.isMounted=!1,clearInterval(this.timer)},render:function(){var e=this,t=this.handleImport,a=this.renderLoginTypeTabs,n=this.renderInputs,s=this.tryGetCachedValue,r=(s("password"),this.props.pageConfig),o=a(),l=n();if(this.props.pageConfig.notice)var p=JSON.parse(this.props.pageConfig.notice).content,d=JSON.parse(this.props.pageConfig.notice).title;var c=i.default.createElement("div",{className:"config-import-page"},this.props.pageConfig.notice?i.default.createElement("div",{style:{fontSize:"12px",marginBottom:"30px"}},i.default.createElement(g.default,{content:p,height:"30px",top:"0px",title:d})):null,o,l.length>0?i.default.createElement("div",{className:"form",style:{width:"100%"}},l):null,"QRCODE"!=r.login_type?i.default.createElement("div",null,i.default.createElement("div",{className:"login-other-items"},i.default.createElement(w.default,{ref:"agreementField",uid:r.login_type,frontConf:this.state.frontConf}),i.default.createElement("div",{style:{float:"right",fontSize:"12px",color:u.qsParams.themeColor?"#"+u.qsParams.themeColor:"#5e82fb",padding:"0 15px"}},(this.props.pageConfig.mx_forget_password_url||this.props.pageConfig.forget_password_url)&&"1"==this.state.frontConf.showMoreInformation?i.default.createElement(h.default,{onTap:function(){return e.handleLink(3)}},i.default.createElement("span",null,"找回密码")):null,(this.props.pageConfig.mx_forget_password_url||this.props.pageConfig.forget_password_url)&&"1"==this.state.frontConf.showMoreInformation&&(this.props.pageConfig.mx_forget_username_url||this.props.pageConfig.forget_username_url)?i.default.createElement("span",null," / "):null,(this.props.pageConfig.mx_forget_username_url||this.props.pageConfig.forget_username_url)&&"1"==this.state.frontConf.showMoreInformation?i.default.createElement(h.default,{onTap:function(){return e.handleLink(4)}},i.default.createElement("span",null,"找回用户名")):null)),i.default.createElement("div",{className:"page-wrapper"},i.default.createElement(h.default,{onTap:t},i.default.createElement(v.default,{types:"full",disable:this.state.login,state:this.state.login,onTap:function(){},getState:function(e){switch(e){case!0:return"提交";default:return"提交"}}}))),i.default.createElement("div",{style:{color:u.qsParams.themeColor?"#"+u.qsParams.themeColor:"#5e82fb"},className:"link-wrapper"},this.props.pageConfig.login_url&&"1"==this.state.frontConf.showMoreInformation?i.default.createElement("div",{onClick:function(){e.handleLink(2)}},i.default.createElement("span",{className:"ion-ios-world"}),i.default.createElement("a",{style:{color:u.qsParams.themeColor?"#"+u.qsParams.themeColor:"#5e82fb"}},"前往官网")):null,this.props.pageConfig.mx_register_url&&"1"==this.state.frontConf.showMoreInformation?i.default.createElement("div",{onClick:function(){e.handleLink(1)}},i.default.createElement("span",{className:"ion-ios-redo-outline"}),i.default.createElement("a",{style:{color:u.qsParams.themeColor?"#"+u.qsParams.themeColor:"#5e82fb"}},"开通网银")):null)):null);return i.default.createElement("div",null,c,"QRCODE"==r.login_type?i.default.createElement("div",null,this.state.showQRCodeInstruction?i.default.createElement("div",{style:{position:"fixed"},className:"vcode-tips-bg",onClick:function(){e.setState({showQRCodeInstruction:!1})}},i.default.createElement("div",{className:"iknow-button"},"我知道了"),this.renderInstructionView()):null):null)},handleLink:function(e){var t=this.context.history.pushState,a=window.location.protocol+"//"+window.location.host+window.document.location.pathname+"#",n=this.props.pageConfig.register_url,s=this.props.pageConfig.forget_password_url,i=this.props.pageConfig.forget_username_url,r=function(){return(C.default.apiToken?"apitoken="+C.default.apiToken:"apikey="+C.default.apiKey)+"&userId="+u.qsParams.userId+"&themeColor="+u.qsParams.themeColor};switch(this.props.pageConfig.mx_register_url&&(n=a+this.props.pageConfig.mx_register_url+"?"+r()),this.props.pageConfig.mx_forget_password_url&&(s=a+this.props.pageConfig.mx_forget_password_url+"?"+r()),this.props.pageConfig.mx_forget_username_url&&(i=a+this.props.pageConfig.mx_forget_username_url+"?"+r()),e){case 1:c.default.openWebView("开通网银",n,"","");break;case 2:c.default.openWebView("网银登录",this.props.pageConfig.login_url,"","");break;case 3:c.default.openWebView("找回密码",s,"","");break;case 4:c.default.openWebView("找回用户名",i,"","");break;case 5:"1"==this.state.frontConf.showHelpInIframe?(u.qsParams.url=encodeURIComponent(this.props.pageConfig.help_url),t({title:"帮助"},"/otherView",u.qsParams)):c.default.openWebView("帮助",this.props.pageConfig.help_url,"","")}},renderLoginTypeTabs:function(){var e=(this.selectLoginType,this.state.loginTypeIndex,this.props.pageConfig,null),t=100..toFixed(2);return{backgroundColor:u.qsParams.themeColor?"#"+u.qsParams.themeColor:T,width:t+"%",borderRight:"1px solid #"+u.qsParams.themeColor},{color:"#"+u.qsParams.themeColor,backgroundColor:"white",width:t+"%",borderRight:"1px solid #"+u.qsParams.themeColor},{borderColor:"#"+u.qsParams.themeColor},e},renderInputs:function(){var e,t=this,a=this.tryGetCachedValue,n=this.wrapValidator,s=(this.getPasswordCache,this.state.loginTypeIndex,this.props.pageConfig),r=a("username"),o=a("password");if(s.username1_desc){e=r;var l=r.indexOf(",");r=r.substring(0,l),e=e.substring(l+1)}var d=!1,c=(0,p.getParams)("loginParams")?(0,p.getParams)("loginParams"):{};c[s.login_type]&&(d=!0);var m=[];if("QRCODE"!=s.login_type)for(var g=0;g<3;g++){var f=null;f=0==g?i.default.createElement("div",{className:"input-items-box"},i.default.createElement("div",{className:"input-items",key:s.login_type+"input"+g},i.default.createElement(x.default,{key:s.login_type+"input"+g,type:"text",ref:s.login_type+"input"+g,defaultValue:d&&c[s.login_type].username?c[s.login_type].username:r,placeholder:s.username_desc,validator:n(s.username_regex),onChanges:function(e){return t.changeCon(e,0,s.username_regex,s.username1_desc)},disabled:!!d&&!!c[s.login_type].username}),g>0?null:this.props.pageConfig.help_url?i.default.createElement("div",{onClick:function(){return t.handleLink(5)},className:"d-tiao"},"帮助",i.default.createElement("span",{style:{fontSize:"18px",color:u.qsParams.themeColor?"#"+u.qsParams.themeColor:"#5e82fb"},className:"ion-ios-help-outline"})):null),i.default.createElement("div",{className:this.state.isRight0?"log-right":"log-wrong"},s.username_tips)):1==g?s.username1_desc?i.default.createElement("div",{className:"input-items-box"},i.default.createElement("div",{className:"input-items",key:s.login_type+"input"+g},i.default.createElement(x.default,{key:s.login_type+"input"+g,type:"text",ref:s.login_type+"input"+g,defaultValue:d&&c[s.login_type].username1?c[s.login_type].username1:e,placeholder:s.username1_desc,validator:n(s.username1_desc),onChanges:function(e){return t.changeCon(e,1,s.username1_regex,s.username1_desc)},disabled:!!d&&!!c[s.login_type].username1})),i.default.createElement("div",{className:this.state.isRight1?"log-right":"log-wrong"},s.username1_tips)):null:i.default.createElement("div",{className:"input-items-box"},i.default.createElement("div",{className:"input-items",key:s.login_type+"input"+g},i.default.createElement(x.default,{key:s.login_type+"input"+g,type:this.state.Type,ref:s.login_type+"input"+g,defaultValue:d&&c[s.login_type].password?c[s.login_type].password:o,placeholder:s.password_desc,validator:n(s.password_regex),onChanges:function(e){return t.changeCon(e,2,s.password_regex,s.username1_desc)},disabled:!!d&&!!c[s.login_type].password}),i.default.createElement("div",{onClick:this.showPwd,className:"tex_box"},i.default.createElement("span",{style:{backgroundImage:this.state.bgImg},className:"password password_show"}))),i.default.createElement("div",{className:this.state.isRight2?"log-right":"log-wrong"},s.password_tips)),m.push(f)}else{var h=this.renderQRCode();m.push(h)}return m},renderQRCode:function(){var e=this,t=this.props,n=t.qrcodeValue,s=t.qrcodeTimeout,r=t.getQrcodeError,o=t.bankId;return i.default.createElement("div",null,i.default.createElement("div",{className:"qrcode-login"},i.default.createElement("div",{className:"qrcode-title"},function(){return null==n?e.state.gettingCode?s?r?"获取二维码失败":"二维码超时":"正在获取二维码":"点击图片获取二维码":"扫码授权"}()),i.default.createElement("div",{className:"qrcode-content"},this.state.gettingCode?null:i.default.createElement(h.default,{onTap:function(){e.createBankQrcodeTask()}},i.default.createElement("div",null,i.default.createElement("img",{className:"qrcode-center",src:N.replace("{bankMark}",o)}))),n?i.default.createElement(h.default,{onPress:function(t){e.onPressImg(n),t.preventDefault()}},i.default.createElement("div",null,i.default.createElement("img",{className:"qrcode-image",src:"data:image/png;base64,"+n}))):i.default.createElement(h.default,{onTap:function(){s&&e.createBankQrcodeTask()}},i.default.createElement("div",{className:"qrcode-image"},s?i.default.createElement("div",{className:"qrcode-retry-button"},"点击重新获取"):null)),function(){return null==n&&e.state.gettingCode?s?i.default.createElement(h.default,{onTap:function(){s&&e.createBankQrcodeTask()}},i.default.createElement("img",{className:"qrcode-center",src:a(62)})):i.default.createElement("img",{className:"qrcode-center",src:N.replace("{bankMark}",o)}):null}(),n||s||!this.state.gettingCode?null:i.default.createElement("img",{className:"qrcode-center-circle",src:a(61)})),i.default.createElement("div",{className:"qrcode-instruction"},i.default.createElement("div",{className:"qrcode-instruction-text"},c.default.Device.Mobile?!c.default.Device.Wechat&&u.BankApplink[o]&&u.BankApplink[o].link?"1.长按或截图保存二维码\r\n2.请点击扫一扫进行扫码授权\r\n3.扫码后请稍作等待":'1.长按或截图保存二维码\r\n2.打开APP"'+u.BankApplink[o].appName+'"进行扫码授权\r\n3.扫码后请稍作等待':'1.请打开手机APP"'+u.BankApplink[o].appName+'"扫码\r\n2.扫码后请稍作等待')),n?i.default.createElement("div",{className:"vcode-dialog-body-operation",style:{padding:0}},i.default.createElement("div",{className:"operation-main"},i.default.createElement(v.default,{types:"small outline",onTap:function(){e.setState({showQRCodeInstruction:!0})}},"查看指引"),c.default.Device.Mobile&&!c.default.Device.Wechat&&u.BankApplink[o]&&u.BankApplink[o].link?i.default.createElement(v.default,{types:"small outline",onTap:function(){c.default.mxOpenUrl({url:u.BankApplink[o].link})}},"扫一扫"):null)):null))},handleImport:function(){function e(){l.default.set("bank",i,m,s.login_type,{loginParamAccount:d,loginFail:!0})}var t=this;if(!this.state.login){var a=this.onSubmitTaskDone,n=this.props,s=n.pageConfig,i=n.bankId;if(n.onImport,this.state.loginTypeIndex,!this.refs.agreementField.isChecked(k.AGREEMENT_TYPE.MOXIE))return void setTimeout(function(){return c.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs.agreementField.isChecked(k.AGREEMENT_TYPE.TENANT))return void setTimeout(function(){return c.default.alert("请勾选同意《用户使用协议》","")});var o=this.refs.agreementField.isChecked(k.AGREEMENT_TYPE.PASSWORD),p={username:this.refs[s.login_type+"input0"].getValue(),password:this.refs[s.login_type+"input2"].getValue()},d={username:this.refs[s.login_type+"input0"].getValue()};if(p.account=p.username,!new RegExp(s.username_regex).test(p.account))return void setTimeout(function(){return c.default.alert("请输入正确的账号")});if(!new RegExp(s.password_regex).test(p.password))return void setTimeout(function(){return c.default.alert("密码不符合要求，请重新输入")});if(s.username1_desc&&(p.username1=this.refs[s.login_type+"input1"].getValue(),p.account=p.account+","+p.username1,!new RegExp(s.username1_regex).test(p.username1)))return void setTimeout(function(){return c.default.alert("请输入正确的卡号")});this.setState({login:!0});var m=this.props.cardType||u.qsParams.cardType;(0,r.submitTaskHelper)({taskType:"bank",taskSubType:i,loginTarget:m,loginType:s.login_type,username:p.account,password:p.password,rmbPwd:o?"1":"0"}).then(function(e){if(t.setState({login:!1}),e.body.task_id){c.default.refreshStatus("2","创建任务成功"),c.default.mxSaveTaskId(e.body.task_id);var n={taskId:e.body.task_id,bankId:i,loginTarget:m,loginType:s.login_type,taskType:"bank",loginParam:{username:p.account}};a(n)}}).catch(function(a){t.setState({login:!1}),c.default.refreshStatus("-3","服务异常，创建任务失败"),e(),t.handleError(a)})}},changeCon:function(e,t,a,n){0==t?new RegExp(a).test(e.target.value)?this.setState({isRight0:!0}):this.setState({isRight0:!1}):1==t?new RegExp(a).test(e.target.value)?this.setState({isRight1:!0}):this.setState({isRight1:!1}):new RegExp(a).test(e.target.value)?this.setState({isRight2:!0}):this.setState({isRight2:!1});var s=this.props.pageConfig,i={username:this.refs[s.login_type+"input0"].getValue(),password:this.refs[s.login_type+"input2"].getValue()};i.account=i.username,s.username1_desc?(i.username1=this.refs[s.login_type+"input1"].getValue(),new RegExp(s.username_regex).test(i.account)&&new RegExp(s.password_regex).test(i.password)&&new RegExp(s.username1_regex).test(i.username1)?this.setState({login:!1}):this.setState({login:!0})):new RegExp(s.username_regex).test(i.account)&&new RegExp(s.password_regex).test(i.password)?this.setState({login:!1}):this.setState({login:!0})},getLastLogin:function(){var e=this.props.cardType||u.qsParams.cardType,t=this.props,a=t.pageConfig,n=t.bankId;return l.default.get("bank",n,e,a.login_type)},showPwd:function(){"text"==this.state.Type?this.setState({Type:"password",bgImg:"url("+a(20)+")"}):this.setState({Type:"text",bgImg:"url("+a(36)+")"})},handleError:function(e){var t=e&&e.body&&e.body.detail||"网络异常，请稍后再试!\n"+e;c.default.alert(t)},onPressImg:function(e){try{"function"==typeof window.mxPostMessage&&window.mxPostMessage(JSON.stringify({type:"mxSaveImg",value:e,succText:"保存成功，请点击扫一扫进行扫码",failText:"保存失败，请截图后进行扫码"}))}catch(e){}},renderInstructionView:function(){var e=this.props.bankId;return c.default.Device.Mobile?i.default.createElement("div",{className:"instruction-view"},i.default.createElement("div",{className:"instruction-view-card"},i.default.createElement("div",{className:"text1"},"第一步"),i.default.createElement("div",{className:"text2"},"长按或截图保存二维码",i.default.createElement("br",null),"点击扫一扫跳转APP"),i.default.createElement("img",{src:a(145)})),c.default.Device.Wechat?i.default.createElement("div",{className:"instruction-view-card"},i.default.createElement("div",{className:"text1"},"第二步"),i.default.createElement("div",{className:"text2"},"打开APP的扫一扫功能"),i.default.createElement("img",{src:u.BankApplink[e]?u.BankApplink[e].instructionImg:""})):i.default.createElement("div",{className:"instruction-view-card"},i.default.createElement("div",{className:"text1"},"第二步"),i.default.createElement("div",{className:"text2"},"打开APP的扫一扫功能"),i.default.createElement("img",{src:u.BankApplink[e]?u.BankApplink[e].instructionImg:""})),i.default.createElement("div",{className:"instruction-view-card"},i.default.createElement("div",{className:"text1"},"第三步"),i.default.createElement("div",{className:"text2"},"打开相册，扫描二维码"),i.default.createElement("img",{src:a(144)}))):i.default.createElement("div",{className:"instruction-view",style:{width:"100%"}},i.default.createElement("div",{className:"instruction-view-card",style:{width:"100%"}},i.default.createElement("div",{className:"text2"},"打开APP的扫一扫功能进行扫描"),i.default.createElement("img",{src:u.BankApplink[e]?u.BankApplink[e].instructionImg:""})))},createBankQrcodeTask:function(){var e=this,t=this.onSubmitTaskDone,a=this.props,n=(a.pageConfig,a.bankId),s=(a.onImport,a.changeQRcodeTimeout);this.state.loginTypeIndex,s();var i=void 0,o=this.props.cardType||u.qsParams.cardType;this.setState({gettingCode:!0}),(0,r.submitTaskHelper)({taskType:"bank",taskSubType:n,loginTarget:o,loginType:"QRCODE",username:"QRCODE",password:"QRCODE"}).then(function(e){if(i=e,e.body.task_id){var a={taskId:e.body.task_id,bankId:n,loginTarget:o,taskType:"bank",loginType:"qrcode"};storage.setItem(n+"-"+o+"-bankQRCodeTask",JSON.stringify(a)),t(a)}}).catch(function(t){var a=t&&t.response&&t.response.body||{};a.errors&&a.errors[0]&&(10220011===a.errors[0].code||10220012===a.errors[0].code)?(c.default.refreshStatus("-2",a.errors[0].message),e.showUnsupport(a.errors[0].message)):(c.default.refreshStatus("-3","服务异常，创建二维码任务失败"),e.handleError(t,a.detail))})},selectLoginType:function(e){this.setState({loginTypeIndex:e})},onSubmitTaskDone:function(e){return e.importResult={},this.props.onSubmitTaskDone(e),!0},tryGetCachedValue:function(e){var t=this.getLastLogin();return t&&t.loginParam&&t.loginParam[e]?t.loginParam[e]:""},wrapValidator:function(e){return function(t){return""===t||new RegExp(e).test(t)}}});I.contextTypes={history:s.PropTypes.history},t.default=I,e.exports=t.default}).call(this)}finally{}}});