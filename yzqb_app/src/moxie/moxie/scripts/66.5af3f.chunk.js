webpackJsonp([66],{225:function(e,t,r){try{(function(){"use strict";function a(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],a=!0,n=!1,s=void 0;try{for(var o,l=e[Symbol.iterator]();!(a=(o=l.next()).done)&&(r.push(o.value),!t||r.length!==t);a=!0);}catch(e){n=!0,s=e}finally{try{!a&&l.return&&l.return()}finally{if(n)throw s}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=r(2),o=a(s),l=r(1),i=r(8),u=r(9),d=a(u),f=r(4),p=a(f),c=r(14),m=a(c),h=r(13),y=a(h),g=r(5),v=a(g),E=r(11),T=(a(E),r(18)),w=a(T),S=r(6),b=a(S),k=r(7),I=a(k),N=r(41),_=a(N),U=o.default.createClass({displayName:"ImportForm",getInitialState:function(){return{phoneInfo:null,unsupport:!1,showUnsupport:!1,isStart:!1,defaultUsername:"",frontConf:this.props.frontConf}},componentDidMount:function(){},componentWillUnmount:function(){this.unmount=!0},render:function(){var e=this.handleImport,t=this.state,r=t.unsupport,a=t.showUnsupport,n=t.isStart,s=(t.defaultUsername,m.default.get("didi",0,0,0)),l="";s&&s.loginParam&&(l=s.loginParam.phone);var i=o.default.createElement(I.default,{onTap:d.default.bind(this,null)},o.default.createElement("i",{className:"ion-chevron-left"})),u=("YES"==this.props.isWeb?o.default.createElement(b.default,{title:"滴滴",left:i}):null,a?o.default.createElement("div",{className:"carrier-unsupport"},o.default.createElement("i",null),o.default.createElement("p",null,r)):o.default.createElement("div",{className:"config-import-page"},o.default.createElement("div",{className:"form common-form"},o.default.createElement("div",{className:"input-item"},o.default.createElement(y.default,{type:"text",ref:"username",id:"zxUsername",placeholder:"请输入滴滴手机号",label:"sms"==this.props.loginType?"手机号":"账户名",defaultValue:l})),"pwd"==this.props.loginType?o.default.createElement("div",{className:"input-item"},o.default.createElement(y.default,{type:"password",ref:"password",id:"zxPassword",placeholder:"请输入登录密码",label:"密码"})):null),o.default.createElement(_.default,{ref:"agreementField",uid:this.props.loginType,frontConf:this.state.frontConf}),o.default.createElement("div",{className:"page-wrapper"},o.default.createElement(v.default,{types:"full",onTap:e,disable:n,state:n,getState:function(e){switch(e){case!1:return"提交";case!0:return"登录中...";default:return"提交"}}}))));return o.default.createElement("div",null,o.default.createElement(w.default,null,u))},handleImport:function(){var e=this;if(!this.refs.agreementField.isChecked(N.AGREEMENT_TYPE.MOXIE))return void setTimeout(function(){return p.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs.agreementField.isChecked(N.AGREEMENT_TYPE.TENANT))return void setTimeout(function(){return p.default.alert("请勾选同意《用户使用协议》","")});var t=this.props.onSubmitTaskDone,r=(this.state.phoneInfo,this.refs.username.getValue()),a=void 0;if("pwd"==this.props.loginType&&(a=this.refs.password.getValue()),!r)return void setTimeout(function(){return p.default.alert("请输入正确的登录名","")});if("pwd"==this.props.loginType&&!a)return void setTimeout(function(){return p.default.alert("请输入正确的登录密码","")});this.setState({isStart:!0});var n=void 0;(0,i.submitTaskHelper)({taskType:"didi",loginType:this.props.loginType,username:r,password:a}).then(function(a){if(n=a,a.body.task_id){e.setState({isStart:!1}),p.default.refreshStatus("2","创建任务成功"),p.default.mxSaveTaskId(a.body.task_id);var s={taskId:a.body.task_id,username:r,mappingId:a.body.mapping_id,taskType:"didi",loginType:e.props.loginType,loginParam:{phone:r}};t(s)}}).catch(function(t){e.setState({isStart:!1}),console.log(t);var r=t&&t.response&&t.response.body||{};r.errors&&r.errors[0]&&(10220011===r.errors[0].code||10220012===r.errors[0].code)?(p.default.refreshStatus("-2",r.errors[0].message),e.showUnsupport(r.errors[0].message)):(p.default.refreshStatus("-3","服务异常，创建任务失败"),e.handleError(t,r.detail))})},handleError:function(e){var t=arguments.length<=1||void 0===arguments[1]?"任务提交失败":arguments[1];try{t=e&&e.body&&e.body.detail||t}catch(e){}if("任务提交失败"==t){if(e&&e.message&&e.message.indexOf("the network is offline")!=-1)return void p.default.alert("网络开小差啦，请稍后再试");p.default.alert(t+"\n"+e)}else p.default.alert(t);this.setState({isStart:!1})},handleForgetSMS:function(e){var t=n(e,3),r=t[0],a=t[1],s=t[2];p.default.confirm(a,"","取消,发送",function(e){2==e&&((0,l.isIOS)()?window.location.href="sms:"+s+"&body="+r:window.location.href="sms:"+s+"?body="+r)})},showUnsupport:function(e){this.setState({unsupport:e||this.state.unsupport,showUnsupport:!0})}});t.default=U,e.exports=t.default}).call(this)}finally{}}});