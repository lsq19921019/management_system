webpackJsonp([61],{229:function(e,t,a){try{(function(){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var r=a(2),l=n(r),s=a(1),i=a(8),o=a(9),u=n(o),d=a(4),f=n(d),c=a(14),m=n(c),p=a(10),h=n(p),g=a(13),v=n(g),E=a(5),y=n(E),b=a(18),S=n(b),T=a(6),I=n(T),N=a(7),k=n(N),P=a(41),C=n(P),_=l.default.createClass({displayName:"ImportForm",propTypes:{pageConfig:r.PropTypes.object.isRequired},getInitialState:function(){return{phoneInfo:null,isStart:!1,defaultPolicyNum:"",defaultIdNo:"",frontConf:this.props.frontConf}},getDefaultProps:function(){return{title:""}},componentDidMount:function(){},componentWillUnmount:function(){this.unmount=!0},render:function(){var e=(this.handleForget,this.handleImport),t=(this.handleProtocol,this.state),a=t.isStart,n=(t.defaultIdNo,t.defaultPolicyNum),r=this.props.title,i=this.props.pageConfig,o=l.default.createElement(k.default,{onTap:u.default.bind(this,null)},l.default.createElement("i",{className:"ion-chevron-left"})),d=(l.default.createElement(I.default,{title:r,left:o}),this.props.params.insuranceId||s.qsParams.insurance_id),f=[];f=JSON.parse(i);var c=[];c.push(l.default.createElement("div",{className:"centerImgDiv-insurance"},l.default.createElement("div",{className:"centerImg-type3 i-"+d})));for(var p=0;p<f.length;p++)if("text"==f[p].type){var g="";if("idno"==f[p].code){var E=m.default.get("insurance",0,0,0);E&&E.loginParam&&(g=E.loginParam.account)}c.push(l.default.createElement("div",{className:"input-item"},l.default.createElement(v.default,{type:"text",ref:f[p].code,id:f[p].code,defaultValue:g,placeholder:"请输入"+f[p].name,label:f[p].name}),l.default.createElement("div",{onClick:this.clearValue.bind(this,"#"+f[p].code),className:"tex_box name"},l.default.createElement("span",{className:"textt"}))))}else if("select"==f[p].type){for(var b=f[p].name.split(","),T=f[p].value.split(","),N=[],P=0;P<b.length;P++)N.push(l.default.createElement("option",{value:T[P]},b[P]));var _=l.default.createElement("select",{defaultValue:T[0],id:"policynumSelect"},N);c.push(l.default.createElement("div",{className:"input-item"},l.default.createElement(v.default,{type:"text",ref:f[p].code,id:f[p].code,defaultValue:n,placeholder:"请输入"+f[p].name.replace(",","或"),label:_}),l.default.createElement("div",{onClick:this.clearValue.bind(this,"#"+f[p].code),className:"tex_box name"},l.default.createElement("span",{className:"textt"}))))}var x=l.default.createElement("div",null,l.default.createElement("div",{className:"form common-form"},c),l.default.createElement(C.default,{ref:"agreementField",uid:"0",frontConf:this.state.frontConf}),l.default.createElement("div",{className:"page-wrapper"},l.default.createElement(h.default,{onTap:e},l.default.createElement(y.default,{types:"full",onTap:function(){},disable:a,state:a,getState:function(e){switch(e){case!1:return"提交";case!0:return"登录中...";default:return"提交"}}}))));return l.default.createElement("div",null,l.default.createElement(S.default,null,x))},clearValue:function(e){document.querySelector(e).parentNode.querySelector("input").value=""},handleImport:function(){var e=this;if(!this.refs.agreementField.isChecked(P.AGREEMENT_TYPE.MOXIE))return void setTimeout(function(){return f.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs.agreementField.isChecked(P.AGREEMENT_TYPE.TENANT))return void setTimeout(function(){return f.default.alert("请勾选同意《用户使用协议》","")});var t=this.props,a=(t.pageConfig,t.onSubmitTaskDone);if(this.state.phoneInfo,!this.refs.idno.getValue())return void setTimeout(function(){return f.default.alert("请填写完整的信息","")});if(!this.refs.policynum.getValue())return void setTimeout(function(){return f.default.alert("请填写完整的信息","")});this.setState({isStart:!0});var n=this.refs.idno.getValue(),r=this.refs.policynum.getValue(),l="policynum";null!=document.getElementById("policynumSelect")&&(l=document.getElementById("policynumSelect").value);var o=this.props.params.insuranceId||s.qsParams.insurance_id,u=void 0;(0,i.submitTaskHelper)({taskType:"insurance",taskSubType:o,username:r,password:n,loginType:l}).then(function(t){if(u=t,t.body.task_id){e.setState({isStart:!1}),f.default.refreshStatus("2","创建任务成功"),f.default.mxSaveTaskId(t.body.task_id);var r={taskId:t.body.task_id,mappingId:t.body.mapping_id,bankId:e.props.params.insuranceId,username:n,taskType:"insurance",loginParam:{account:n}};a(r)}}).catch(function(t){console.log(t),e.setState({isStart:!1});var a=t&&t.response&&t.response.body||{};a.errors&&a.errors[0]&&(10220011===a.errors[0].code||10220012===a.errors[0].code)?(f.default.refreshStatus("-2",a.errors[0].message),e.showUnsupport(a.errors[0].message)):(f.default.refreshStatus("-3","服务异常，创建任务失败"),e.handleError(t,a.detail))})},handleError:function(e){var t=arguments.length<=1||void 0===arguments[1]?"任务提交失败":arguments[1];try{t=e&&e.body&&e.body.detail||t}catch(e){}if("任务提交失败"==t){if(e&&e.message&&e.message.indexOf("the network is offline")!=-1)return void f.default.alert("网络开小差啦，请稍后再试");f.default.alert(t+"\n"+e)}else f.default.alert(t);this.setState({isStart:!1})},handleTanentProtocol:function(){var e=s.qsParams.tenantAgreementUrl||this.state.frontConf.tenantAgreementUrl;f.default.openWebView("用户使用协议",e,"","agreement")},handleProtocol:function(){var e=s.qsParams.agreementUrl||this.state.frontConf.agreementUrl;f.default.openWebView("用户使用协议",e,"","agreement")},autoImport:function(){this.props.auto&&this.handleImport()}});t.default=_,e.exports=t.default}).call(this)}finally{}}});