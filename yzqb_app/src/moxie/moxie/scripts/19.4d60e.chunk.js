webpackJsonp([19,66],{15:function(e,t,n){try{(function(){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),l=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n;o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(i)}var u=Object.getPrototypeOf(a);if(null===u)return;e=u,t=r,n=i,o=!0,s=u=void 0}},u=n(2),d=o(u),c=n(16),f=n(10),p=(o(f),n(1)),h=function(e){function t(e,n){r(this,t),l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.state={}}return i(t,e),s(t,[{key:"componentDidMount",value:function(){}},{key:"render",value:function(){var e=this.props,t=e.showTips,n=e.showOrHideSpinner,o=e.size,r=e.color,i=e.boxSize,s=(a(e,["showTips","showOrHideSpinner","size","color","boxSize"]),{display:n,width:"100%",maxWidth:p.qsParams.maxWidth?p.qsParams.maxWidth:"800px",height:p.qsParams.height?p.qsParams.height+"px":"100%",position:"fixed",right:0,bottom:0,margin:"0 auto",left:0,top:0,zIndex:996,background:"rgba(0,0,0,.4)"});return d.default.createElement("div",{style:s},d.default.createElement("div",{className:"SpinerBox",style:{overflow:"hidden",background:"rgba(22,22,22,0.8)",position:"absolute",top:"40%",left:"50%",width:""+i,height:""+i,borderRadius:"10px"}},d.default.createElement("div",{className:"newSpiner",style:{top:t?i/6+"px":(i-o)/2+"px"}},d.default.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 32 32",width:o,height:o,fill:r},d.default.createElement("path",{opacity:".25",d:"M16 0 A16 16 0 0 0 16 32 A16 16 0 0 0 16 0 M16 4 A12 12 0 0 1 16 28 A12 12 0 0 1 16 4"}),d.default.createElement("path",{d:"M16 0 A16 16 0 0 1 32 16 L28 16 A12 12 0 0 0 16 4z"}))),d.default.createElement("div",{style:{color:"#fff",textAlign:"center",width:"100%",fontSize:"13px",position:"absolute",top:""+2*i/3}},t)))}}]),t}(d.default.Component);t.default=h,h.contextTypes={history:function(){return c.PropTypes.history}},h.defaultProps={boxSize:120,size:48,showTips:"正在加载",color:"#fff"},e.exports=t.default}).call(this)}finally{}},17:function(e,t,n){try{(function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e={DEFAULT:"DEFAULT",SUCC:"SUCC",FAIL:"FAIL"};t.TASK_STATUS=e}).call(this)}finally{}},19:function(e,t,n){try{(function(){"use strict";function e(e){return e&&e.__esModule?e:{default:e}}function o(e){var t=e.task,n=e.callbacks;n=l({waitCode:u.noop,doneSucc:u.noop,doneFail:u.noop,doneTimeout:u.noop,doneLogin:u.noop,pendingTimeout:u.noop,doing:u.noop,error:u.noop,spiner:u.noop,showProgress:u.noop,importSucc:u.noop,onError:u.noop,errorCatch:u.noop,refreshImgCode:u.noop,setqrCodeTaskInfo:u.noop,doneScan:u.noop,zxBankSpiner:u.noop,showQrcodeInCrawlStatus:u.noop,hideQrCode:u.noop},n);var c,f=a(t),p=u.request.get(f+("?d="+Date.now())).set(l({},h.default.addDefaultHeaders())).set("Accept","application/json").set("Cache-Control","no-store");return c="carrier"==t.taskType?(0,u.guardTimeoutLongtime)(p):(0,u.guardTimeout)(p),c.then(function(e){var a=!1;if(n.setqrCodeTaskInfo&&"qrcode"==t.loginType&&n.setqrCodeTaskInfo(t),n.showProgress&&n.showProgress(e.body.description),"LOGIN"!=e.body.phase&&(n.doneLogin&&(a=n.doneLogin(t,e.body)),"alipay"==t.taskType&&"WAIT_CODE"!=e.body.phase_status&&n.hideQrCode&&n.hideQrCode(),r(t),(d.qsParams.quitOnLoginDone||d.qsParams.canLeave)&&"zhengxin"!=t.taskType))return a=!0,!1;switch("LOGIN"==e.body.phase&&"WAIT_CODE"!=e.body.phase_status&&n.doneScan&&n.doneScan(),e.body.phase_status){case g.WAIT_CODE:n.spiner&&n.spiner(),n.zxBankSpiner&&n.zxBankSpiner(),n.waitCode&&(a=n.waitCode(t,e.body));break;case g.CONTINUE:n.spiner&&n.spiner(),n.zxBankSpiner&&n.zxBankSpiner(),n.waitCode&&n.waitCode(t,e.body);break;case g.DONE_SUCC:e.body.finished===!0?(n.zxBankSpiner&&n.zxBankSpiner(),storage.setItem(t.taskType+"ImportStatus","succ"),setTimeout(function(){n.spiner&&n.spiner(),n.showProgress&&n.showProgress(""),v.default.refreshStatus("1",e.body.description)},3e3),n.importSucc&&n.importSucc(e.body),n.doneSucc&&n.doneSucc(t,e.body),a=!0,i(t)):n.doing&&(a=n.doing(t,e.body));break;case g.DONE_FAIL:n.hideQrCode&&n.hideQrCode(),storage.setItem(t.taskType+"ImportStatus","fail"),"LOGIN"===e.body.phase?("BALO-23001-10"==e.body.error_code&&n.doneTimeout&&n.doneTimeout(t,e.body),n.refreshImgCode(),v.default.refreshStatus("-4",e.body.description)):v.default.refreshStatus("0",e.body.description),n.zxBankSpiner&&n.zxBankSpiner(),setTimeout(function(){n.spiner&&n.spiner(),n.showProgress&&n.showProgress("")},3e3),n.doneFail&&n.doneFail(t,e.body),a=!0,s(t,e);break;case g.DONE_TIMEOUT:n.hideQrCode&&n.hideQrCode(),storage.setItem(t.taskType+"ImportStatus","fail"),"LOGIN"===e.body.phase?v.default.refreshStatus("-4",e.body.description,t.loginType,e.body.phase):v.default.refreshStatus("0",e.body.description,t.loginType,e.body.phase),n.doneTimeout&&n.doneTimeout(t,e.body),a=!0,s(t,e);break;case g.DOING:v.default.refreshStatus("2",e.body.description,t.loginType,e.body.phase),n.doing&&(a=n.doing(t,e.body));break;default:v.default.refreshStatus("-3","异常错误"),n.doneFail&&n.doneFail(t,e.body),a=!0,s(t,e)}"LOGIN"!=e.body.phase,a||setTimeout(function(){o({task:t,callbacks:n})},T)}).catch(function(e){var o=e&&e.body&&e.body.detail||e;v.default.alert("服务异常，请稍候再试！"+o),n.zxBankSpiner&&n.zxBankSpiner(),n.spiner&&n.spiner(),n.onError&&n.onError(t,e),n.error&&n.error(t,e),n.errorCatch&&n.errorCatch(e)})}function a(e){var t="";return t="bank"==e.taskType?f.default.checkImportState.replace("{taskid}",e.taskId):"carrier"==e.taskType?f.default.checkCarrierImportStatev2.replace("{taskid}",e.taskId):"chsi"==e.taskType?f.default.checkChsiImportState.replace("{taskid}",e.taskId):"fund"==e.taskType?f.default.checkFundImportState.replace("{taskid}",e.taskId):"email"==e.taskType||"qq"==e.taskType?f.default.checkEmailImportState.replace("{taskid}",e.taskId):"tax"==e.taskType?f.default.taxStatus.replace("{task_id}",e.taskId)+("?d="+Date.now()):"security"==e.taskType?f.default.checkSecurityImportState.replace("{taskid}",e.taskId)+("?d="+Date.now()):"alipay"==e.taskType||"wechat"==e.taskType?f.default.commonImportStateUrlv2.replace("{taskid}",e.taskId):"sametrade"==e.taskType?f.default.checkSametradeTaskStatus.replace("{task_id}",e.taskId):f.default.commonImportStateUrl.replace("{taskid}",e.taskId)}function r(e){v.default.mxHideWebView(),v.default.mxCanLeave(!0),v.default.loginDone=1,(d.qsParams.canLeave||d.qsParams.quitOnLoginDone)&&"zhengxin"!=e.taskType&&(console.log("finishImport"),v.default.finishImport(e.taskId,"2","登录认证成功","SUCC"),(0,y.default)({taskType:e.taskType}))}function i(e){v.default.finishImport(e.taskId,"1","认证成功","SUCC"),(0,y.default)({taskType:e.taskType})}function s(e,t){console.log("handleDoneFail"),"LOGIN"===t.body.phase?"zhengxin"!=e.taskType&&("qrcode"==e.loginType&&"DONE_TIMEOUT"==t.body.phase_status||v.default.alert(t.body.description)):(v.default.finishImport(e.taskId,"0",t.description,"FAIL"),d.qsParams.quitOnFail&&(0,y.default)({taskType:e.taskType}))}Object.defineProperty(t,"__esModule",{value:!0});var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},u=n(1),d=n(1),c=n(25),f=e(c),p=n(12),h=e(p),m=n(29),y=e(m),k=n(4),v=e(k),T=2500,g={DOING:"DOING",WAIT_CODE:"WAIT_CODE",DONE_SUCC:"DONE_SUCC",DONE_FAIL:"DONE_FAIL",DONE_TIMEOUT:"DONE_TIMEOUT"};t.STATE=g,t.default=o}).call(this)}finally{}},21:function(e,t,n){try{(function(){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n;o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(i)}var u=Object.getPrototypeOf(a);if(null===u)return;e=u,t=r,n=i,o=!0,s=u=void 0}},l=n(2),u=o(l),d=function(e){function t(e,n){a(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n)}return r(t,e),i(t,null,[{key:"propTypes",value:{desc:l.PropTypes.string.isRequired},enumerable:!0}]),i(t,[{key:"render",value:function(){var e=u.default.createElement("img",{style:{width:"350px"},src:n(45)});return u.default.createElement("div",{className:"waiting-view"},u.default.createElement("h3",{style:{width:"80%",textAlign:"center",fontSize:"16px",color:"#70BEEB",height:"50px",lineHeight:"50px",borderBottom:"1px solid #efeff4"}},"获取结果中..."),u.default.createElement("h4",{style:{height:"20px",fontSize:"14px",color:"#666666"}},this.props.desc),u.default.createElement("div",{className:"waiting-gif"},e))}}]),t}(u.default.Component);t.default=d,e.exports=t.default}).call(this)}finally{}},22:function(e,t,n){try{(function(){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n;o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(i)}var u=Object.getPrototypeOf(a);if(null===u)return;e=u,t=r,n=i,o=!0,s=u=void 0}},l=n(2),u=o(l),d=n(1),c=n(23),f=n(5),p=o(f),h=(n(17),function(e){function t(e,n){a(this,t),s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,e,n),this.state={}}return r(t,e),i(t,null,[{key:"propTypes",value:{succ:l.PropTypes.bool.isRequired,taskInfo:l.PropTypes.any.isRequired,canQuitAuth:l.PropTypes.bool},enumerable:!0}]),i(t,[{key:"render",value:function(){var e=this,t={color:void 0!=d.qsParams.themeColor?"#"+d.qsParams.themeColor:c.DEFAULT_THEMECOLOR,fontSize:"12px"},n=void 0!=d.qsParams.themeColor?"#"+d.qsParams.themeColor:c.DEFAULT_THEMECOLOR,o=null;return o=this.props.succ?u.default.createElement("div",{className:"finish-status succ"},u.default.createElement("svg",{width:"48",height:"48",viewBox:"0 0 48 48"},u.default.createElement("g",{className:"transform-group"},u.default.createElement("g",{transform:"scale(0.046875, 0.046875)"},u.default.createElement("path",{d:"M511.996387 9.862132c-277.328216 0-502.134255 224.813265-502.134255 502.137868 0 277.328216 224.80604 502.137868 502.134255 502.137868 277.320991 0 502.137868-224.809652 502.137868-502.137868C1014.137868 234.675397 789.320991 9.862132 511.996387 9.862132L511.996387 9.862132zM824.889692 388.748635l-351.388132 338.834686c-4.670966 4.663741-9.952445 8.337656-15.587949 11.028971-22.065166 15.761349-52.915939 13.75641-72.730516-6.061779l-150.897848-150.897848c-22.065166-22.065166-22.065166-57.832555 0-79.883271 22.054329-22.065166 57.821717-22.065166 79.886884 0l113.291695 113.28447 317.531758-306.192112c22.061554-22.061554 57.832555-22.061554 79.883271 0C846.954858 330.919692 846.954858 366.687081 824.889692 388.748635L824.889692 388.748635zM824.889692 388.748635",fill:n})))),u.default.createElement("p",{style:t},"验证成功"),d.qsParams.token?u.default.createElement(p.default,{types:"full",style:"width:50%;height:44px;",onTap:function(){e.onSuccDetailButtonClick()}},"详情查询"):null):u.default.createElement("div",{className:"finish-status fail"},u.default.createElement("i",{className:"import-fail-img"}),u.default.createElement("p",{className:"fail-desc",style:{marginBottom:"20px"}},this.props.desc),"YES"!=d.qsParams.notRetryOnFail&&1!=d.qsParams.notRetryOnFail?u.default.createElement(p.default,{types:"full",style:"width:50%;height:44px;",onTap:function(){e.retryButtonClick()}},"点击重试"):null),u.default.createElement("div",{className:"waiting-view"},u.default.createElement("div",{className:"waiting-gif"},o))}},{key:"retryButtonClick",value:function(){window.location.reload()}},{key:"retryButtonClick",value:function(){window.location.reload()}},{key:"onSuccDetailButtonClick",value:function(){if(void 0==d.qsParams.token)return void PG.alert("缺少token值");var e=this.props.taskInfo,t=(0,d.getENV)(),n="";n="test"==t?"http://192.168.0.11:8282":"pre"==t||"qa"==t?"https://qa.51datakey.com":"https://api.51datakey.com";var o="";switch(e.taskType){case"email":o=n+"/h5/resultV3/index.html#/emailResult?taskId="+e.taskId+"&token="+d.qsParams.token+"&mainTitle="+d.qsParams.mainTitle+"&icoUrl="+d.qsParams.icoUrl;break;case"bank":o=n+"/h5/resultV3/index.html#/bankResult/?taskId="+e.taskId+"&token="+d.qsParams.token+"&mainTitle="+d.qsParams.mainTitle+"&icoUrl="+d.qsParams.icoUrl;break;case"carrier":o=n+"/h5/resultV4/carrier/index.html?taskId="+e.account+"&token="+d.qsParams.token+"&mainTitle="+d.qsParams.mainTitle+"&icoUrl="+d.qsParams.icoUrl;break;case"shixin":o=n+"/h5/resultV4/shixin/index.html?taskId="+e.taskId+"&token="+d.qsParams.token+"&mainTitle="+d.qsParams.mainTitle+"&icoUrl="+d.qsParams.icoUrl;break;case"tax":o=n+"/h5/resultV4/tax/index.html?taskId="+e.taskId+"&token="+d.qsParams.token+"&mainTitle="+d.qsParams.mainTitle+"&icoUrl="+d.qsParams.icoUrl;break;case"zhixing":o=n+"/h5/resultV4/zhixing/index.html?taskId="+e.taskId+"&token="+d.qsParams.token+"&mainTitle="+d.qsParams.mainTitle+"&icoUrl="+d.qsParams.icoUrl;break;default:o=n+"/h5/resultV3/index.html#/"+e.taskType+"?taskId="+e.taskId+"&token="+d.qsParams.token+"&mainTitle="+d.qsParams.mainTitle+"&icoUrl="+d.qsParams.icoUrl}"test"==t?o+="&env=test":"pre"!=t&&"qa"!=t||(o+="&env="+t),window.location.href=o}}]),t}(u.default.Component));t.default=h,e.exports=t.default}).call(this)}finally{}},23:function(e,t,n){try{(function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e="#58B5EB";t.DEFAULT_THEMECOLOR=e}).call(this)}finally{}},24:function(e,t,n){try{(function(){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e={LOGIN:"LOGIN",RECEIVE:"RECEIVE",EXTRACT:"EXTRACT",STORE:"STORE",DONE:"DONE"};t.PHASE=e}).call(this)}finally{}},225:function(e,t,n){try{(function(){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var a=function(){function e(e,t){var n=[],o=!0,a=!1,r=void 0;try{for(var i,s=e[Symbol.iterator]();!(o=(i=s.next()).done)&&(n.push(i.value),!t||n.length!==t);o=!0);}catch(e){a=!0,r=e}finally{try{!o&&s.return&&s.return()}finally{if(a)throw r}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),r=n(2),i=o(r),s=n(1),l=n(8),u=n(9),d=o(u),c=n(4),f=o(c),p=n(14),h=o(p),m=n(13),y=o(m),k=n(5),v=o(k),T=n(11),g=(o(T),n(18)),S=o(g),b=n(6),E=o(b),I=n(7),w=o(I),O=n(41),P=o(O),C=i.default.createClass({displayName:"ImportForm",getInitialState:function(){return{phoneInfo:null,unsupport:!1,showUnsupport:!1,isStart:!1,defaultUsername:"",frontConf:this.props.frontConf}},componentDidMount:function(){},componentWillUnmount:function(){this.unmount=!0},render:function(){var e=this.handleImport,t=this.state,n=t.unsupport,o=t.showUnsupport,a=t.isStart,r=(t.defaultUsername,h.default.get("didi",0,0,0)),s="";r&&r.loginParam&&(s=r.loginParam.phone);var l=i.default.createElement(w.default,{onTap:d.default.bind(this,null)},i.default.createElement("i",{className:"ion-chevron-left"})),u=("YES"==this.props.isWeb?i.default.createElement(E.default,{title:"滴滴",left:l}):null,o?i.default.createElement("div",{className:"carrier-unsupport"},i.default.createElement("i",null),i.default.createElement("p",null,n)):i.default.createElement("div",{className:"config-import-page"},i.default.createElement("div",{className:"form common-form"},i.default.createElement("div",{className:"input-item"},i.default.createElement(y.default,{type:"text",ref:"username",id:"zxUsername",placeholder:"请输入滴滴手机号",label:"sms"==this.props.loginType?"手机号":"账户名",defaultValue:s})),"pwd"==this.props.loginType?i.default.createElement("div",{className:"input-item"},i.default.createElement(y.default,{type:"password",ref:"password",id:"zxPassword",placeholder:"请输入登录密码",label:"密码"})):null),i.default.createElement(P.default,{ref:"agreementField",uid:this.props.loginType,frontConf:this.state.frontConf}),i.default.createElement("div",{className:"page-wrapper"},i.default.createElement(v.default,{types:"full",onTap:e,disable:a,state:a,getState:function(e){switch(e){case!1:return"提交";case!0:return"登录中...";default:return"提交"}}}))));return i.default.createElement("div",null,i.default.createElement(S.default,null,u))},handleImport:function(){var e=this;if(!this.refs.agreementField.isChecked(O.AGREEMENT_TYPE.MOXIE))return void setTimeout(function(){return f.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs.agreementField.isChecked(O.AGREEMENT_TYPE.TENANT))return void setTimeout(function(){return f.default.alert("请勾选同意《用户使用协议》","")});var t=this.props.onSubmitTaskDone,n=(this.state.phoneInfo,this.refs.username.getValue()),o=void 0;if("pwd"==this.props.loginType&&(o=this.refs.password.getValue()),!n)return void setTimeout(function(){return f.default.alert("请输入正确的登录名","")});if("pwd"==this.props.loginType&&!o)return void setTimeout(function(){return f.default.alert("请输入正确的登录密码","")});this.setState({isStart:!0});var a=void 0;(0,l.submitTaskHelper)({taskType:"didi",loginType:this.props.loginType,username:n,password:o}).then(function(o){if(a=o,o.body.task_id){e.setState({isStart:!1}),f.default.refreshStatus("2","创建任务成功"),f.default.mxSaveTaskId(o.body.task_id);var r={taskId:o.body.task_id,username:n,mappingId:o.body.mapping_id,taskType:"didi",loginType:e.props.loginType,loginParam:{phone:n}};t(r)}}).catch(function(t){e.setState({isStart:!1}),console.log(t);var n=t&&t.response&&t.response.body||{};n.errors&&n.errors[0]&&(10220011===n.errors[0].code||10220012===n.errors[0].code)?(f.default.refreshStatus("-2",n.errors[0].message),e.showUnsupport(n.errors[0].message)):(f.default.refreshStatus("-3","服务异常，创建任务失败"),e.handleError(t,n.detail))})},handleError:function(e){var t=arguments.length<=1||void 0===arguments[1]?"任务提交失败":arguments[1];try{t=e&&e.body&&e.body.detail||t}catch(e){}if("任务提交失败"==t){if(e&&e.message&&e.message.indexOf("the network is offline")!=-1)return void f.default.alert("网络开小差啦，请稍后再试");f.default.alert(t+"\n"+e)}else f.default.alert(t);this.setState({isStart:!1})},handleForgetSMS:function(e){var t=a(e,3),n=t[0],o=t[1],r=t[2];f.default.confirm(o,"","取消,发送",function(e){2==e&&((0,s.isIOS)()?window.location.href="sms:"+r+"&body="+n:window.location.href="sms:"+r+"?body="+n)})},showUnsupport:function(e){this.setState({unsupport:e||this.state.unsupport,showUnsupport:!0})}});t.default=C,e.exports=t.default}).call(this)}finally{}},805:function(e,t,n){try{(function(){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){var n={};for(var o in e)t.indexOf(o)>=0||Object.prototype.hasOwnProperty.call(e,o)&&(n[o]=e[o]);return n}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(t,"__esModule",{value:!0});var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&(e[o]=n[o])}return e},l=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),u=function(e,t,n){for(var o=!0;o;){var a=e,r=t,i=n;o=!1,null===a&&(a=Function.prototype);var s=Object.getOwnPropertyDescriptor(a,r);if(void 0!==s){if("value"in s)return s.value;var l=s.get;if(void 0===l)return;return l.call(i)}var u=Object.getPrototypeOf(a);if(null===u)return;e=u,t=r,n=i,o=!0,s=u=void 0}},d=n(2),c=o(d),f=n(1),p=n(54),h=o(p),m=n(19),y=o(m),k=n(8),v=n(225),T=o(v),g=n(13),S=(o(g),n(5)),b=(o(S),n(9)),E=o(b),I=n(6),w=o(I),O=n(7),P=o(O),C=n(15),x=o(C),q=n(11),_=(o(q),n(21)),A=o(_),D=n(24),L=n(17),N=n(14),U=o(N),j=n(22),M=o(j),F=n(10),z=(o(F),n(39)),B=n(12),V=o(B),G="此次尝试失败，请重试",R="验证完成",Q=function(e){function t(e,t){r(this,n),u(Object.getPrototypeOf(n.prototype),"constructor",this).call(this,e,t),this.state={selectedIndex:0,taskStatus:L.TASK_STATUS.DEFAULT,isLoginDone:!1,isScanned:!1,showSpiner:!1,qrCodeTaskInfo:null,taskInfo:null,qrcodeValue:null,qrcodeLink:null,qrcodeTimeout:!1,stopPollingQrcode:!1,hasCreatedQrCodeTask:!1,frontConf:V.default.frontConf[V.default.taskType]}}i(t,e),l(t,null,[{key:"propTypes",value:{showVCodeModal:d.PropTypes.func,hideVCodeModal:d.PropTypes.func},enumerable:!0}]),l(t,[{key:"componentDidMount",value:function(){PG.refreshTitle("滴滴登录")}},{key:"componentWillUnmount",value:function(){this.unmounted=!0}},{key:"render",value:function(){var e=this,t=a(this.props,[]),n=void 0;return n=this.state.isLoginDone?this.state.taskStatus==L.TASK_STATUS.DEFAULT?c.default.createElement(A.default,{desc:this.state.desc}):c.default.createElement(M.default,{succ:this.state.taskStatus==L.TASK_STATUS.SUCC,taskInfo:this.state.taskInfo||this.state.qrCodeTaskInfo,desc:this.state.desc}):c.default.createElement("div",null,c.default.createElement(h.default,{selectedIndex:this.state.selectedIndex,onIndexChange:this.onIndexChange.bind(this)},c.default.createElement("div",{key:0,title:"短信验证码"},c.default.createElement(T.default,s({frontConf:this.state.frontConf,loginType:"sms",onSubmitTaskDone:this.onSubmitTaskDone.bind(this)},t))),c.default.createElement("div",{key:1,title:"账号密码"},c.default.createElement(T.default,s({frontConf:this.state.frontConf,loginType:"pwd",onSubmitTaskDone:this.onSubmitTaskDone.bind(this)},t)))),this.state.taskInfo&&this.state.showSpiner?c.default.createElement(x.default,{color:"#fff",showTips:this.state.desc}):null),c.default.createElement("div",{className:"import-carrier"},c.default.createElement("div",{className:"mx-view"},"NO"==f.qsParams.showTitleBar||0==f.qsParams.showTitleBar||PG.Device.SDK?null:c.default.createElement("div",{style:{height:"NO"==f.qsParams.showTitleBar||PG.Device.SDK?0:44}},c.default.createElement(w.default,{title:"滴滴登录",left:c.default.createElement(P.default,{onTap:function(){E.default.call(e)}},c.default.createElement("i",{className:"ion-chevron-left"}))})),n))}},{key:"onIndexChange",value:function(e){this.state.selectedIndex==e,this.setState({showSpiner:!1}),this.setState({selectedIndex:e})}},{key:"onSubmitTaskDone",value:function(e){this.props.hideVCodeModal(),this.setState({taskInfo:e,showSpiner:!0}),this.startPoll(e)}},{key:"handleError",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"任务提交失败":arguments[1];console.log(e);try{t=e&&e.body&&e.body.detail||t}catch(e){}if("任务提交失败"==t){if(e&&e.message&&e.message.indexOf("the network is offline")!=-1)return void PG.alert("网络开小差啦，请稍后再试");PG.alert(t+"\n"+e)}else PG.alert(t);this.setState({isStart:!1})}},{key:"startPoll",value:function(e){var t=this;(0,y.default)({task:e,isLogin:!1,callbacks:{waitCode:this.initVCode.bind(this),doneLogin:this.doneLogin.bind(this),doneSucc:this.onSucc.bind(this),doneFail:this.onFail.bind(this),doneTimeout:this.onFail.bind(this),doing:this.doing.bind(this),pendingTimeout:this.onPendingTimeout.bind(this),error:this.onError.bind(this),doneScan:function(){t.setState({isScanned:!0,showSpiner:!0})}}})}},{key:"initVCode",value:function(e,t){var n=this;return this.unmounted||0!=this.state.selectedIndex&&"qrcode"==e.loginType?(this.setState({stopPollingQrcode:!0}),!0):"qrcode"!=e.loginType&&!this.state.taskInfo||("qrcode"!=t.input.type&&this.setState({showSpiner:!1}),"qrcode"==t.input.type&&"qrcode"==e.loginType?(this.setState({showSpiner:!1}),this.setState({qrcodeValue:JSON.parse(t.input.value).base64,qrcodeLink:JSON.parse(t.input.value).url.replace("http://","didi://").replace("https://","didi://")})):this.props.showVCodeModal({title:"验证码",desc:t.description,waitSeconds:0,type:t.input.type,imgSrc:"img"==t.input.type||"qrcode"==t.input.type?t.input.value:"",onConfirm:function(t){n.submitVCode(t,e),n.setState({showSpiner:!0})},onCancel:function(){n.storeLoginInfo(e,!0),n.setState({taskInfo:null,showSpiner:!1})}}),this.updateState(e,t),!("qrcode"==e.loginType&&"qrcode"==t.input.type&&this.state.qrCodeTaskInfo||"qrcode"==t.input.type&&this.state.taskInfo))}},{key:"submitVCode",value:function(e,t){var n=this;(0,k.submitVCode)(e,t).catch(function(e){console.log(e)}).then(function(){return n.startPoll(t)})}},{key:"doing",value:function(e,t){return this.unmounted||0!=this.state.selectedIndex&&"qrcode"==e.loginType?(this.setState({stopPollingQrcode:!0}),!0):(this.props.hideVCodeModal(),void this.updateState(e,t))}},{key:"doneLogin",value:function(e,t){this.updateState(e,t),this.setState({isLoginDone:!0})}},{key:"updateState",value:function(e,t){this.setState({phase:t.phase,desc:t.description,isLoginDone:t.phase!==D.PHASE.LOGIN})}},{key:"storeLoginInfo",value:function(e){var t=!(arguments.length<=1||void 0===arguments[1])&&arguments[1];this.props.params.cardType||f.qsParams.cardType,void 0==e.bankId&&(e.bankId=0),void 0==e.loginModel&&(e.loginModel=0),void 0==e.loginType&&(e.loginType=0),U.default.set(e.taskType,0,0,e.loginType,{loginParam:e.loginParam,loginFail:t})}},{key:"onSucc",value:function(e,t){return this.storeLoginInfo(e),this.unmounted||0!=this.state.selectedIndex&&"qrcode"==e.loginType?(this.setState({stopPollingQrcode:!0}),!0):(t.description=R,this.updateState(e,t),void this.setState({taskStatus:L.TASK_STATUS.SUCC}))}},{key:"onFail",value:function(e,t){return this.storeLoginInfo(e,!0),this.unmounted||0!=this.state.selectedIndex&&"qrcode"==e.loginType?(this.setState({stopPollingQrcode:!0}),!0):(t.phase!=D.PHASE.LOGIN&&this.setState({taskStatus:L.TASK_STATUS.FAIL,desc:t.description}),this.setState({taskInfo:null}),void this.setState({showSpiner:!1}))}},{key:"onPendingTimeout",value:function(e){return this.storeLoginInfo(e),this.unmounted||0!=this.state.selectedIndex&&"qrcode"==e.loginType?(this.setState({stopPollingQrcode:!0}),!0):(this.setState({taskStatus:L.TASK_STATUS.FAIL,desc:G}),"qrcode"==e.loginType?this.setState({qrCodeTaskInfo:null,isScanned:!1}):this.setState({taskInfo:null}),void this.setState({showSpiner:!1}))}},{key:"onError",value:function(e,t){return this.storeLoginInfo(e,!0),this.unmounted||0!=this.state.selectedIndex&&"qrcode"==e.loginType?(this.setState({stopPollingQrcode:!0}),!0):(console.log(t),this.setState({taskStatus:L.TASK_STATUS.FAIL,desc:"服务异常,请稍后再试"}),"qrcode"==e.loginType?this.setState({qrCodeTaskInfo:null,isScanned:!1}):this.setState({taskInfo:null}),void this.setState({showSpiner:!1}))}},{key:"handleBack",value:function(){(this.state.isLoginDone||this.state.isFail)&&(f.qsParams.backUrl||f.qsParams.back_url)?quitBack({taskType:"didi"}):(this.unmounted=!0,E.default.call(this))}}]);var n=t;return t=(0,z.observer)(t)||t}(c.default.Component);t.default=Q,e.exports=t.default}).call(this)}finally{}}});