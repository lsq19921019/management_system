!function(){var e=require("mod/tools"),t=e.apiUrl(),i={init:function(){i.getImgCode(),i.onEvent()},getImgCode:function(){var i=$(".main-section .register-box");e.fetchAjax(t.data+"/message/image_code").done(function(e){if(0===e.status||"0"===e.status){var t="data:image/png;base64,"+(e.result&&e.result.imgVal);i.find(".img-code").attr("src",t),i.find(".img-code").attr("data-imei",e.result&&e.result.imei)}})},getSmsCode:function(i,s,n,d){var a=$(".main-section .register-box"),o={type:i,cellphone:s,imgCode:n};e.fetchAjax(t.data+"/message/sms_code",o,"post",{imei:d}).done(function(e){if(0===e.status||"0"===e.status){a.find(".tips-register").text("验证码发送成功!").fadeIn(),setTimeout(function(){a.find(".tips-register").text("").hide()},2500);var t=a.find(".get-sms-code"),i=60;t.addClass("disabled");var s=function(e,i){t.html("再次获取("+e+"s)");var n=setTimeout(function(){e--,s(e,i)},i);0==e&&(clearTimeout(n),n=null,t.removeClass("disabled").html("获取验证码"))};s(i,1e3)}else a.find(".tips-register").text(e.error||e.msg).fadeIn()})},onEvent:function(){var s=$(".main-section .register-box");s.find('input[data-must != "false"]').blur(function(){$(this).val()?($(this).removeClass("input-tips"),s.find(".tips-register").text("").hide()):($(this).addClass("input-tips"),s.find(".tips-register").text($(this).attr("placeholder")).fadeIn())}),s.find(".img-code").on("click",function(){i.getImgCode()}),s.find(".get-sms-code").on("click",function(){var e=$(this),t=s.find(".phone").val(),n=s.find(".code-input").val(),d=s.find(".img-code").attr("data-imei");e.hasClass("disabled")||(t?n?i.getSmsCode(1,t,n,d):(s.find(".code-input").addClass("input-tips"),s.find(".tips-register").text("请填写图片验证码").fadeIn()):(s.find(".phone").addClass("input-tips"),s.find(".tips-register").text("手机号不能为空").fadeIn()))}),s.on("click",".register-btn",function(){var n=s.find(".phone").val(),d=s.find(".phone-code-input").val(),a=s.find(".password").val(),o=s.find(".password-again").val(),r=s.find(".invite-code").val();if(n)if(d)if(a)if(a!==o)s.find(".password-again").addClass("input-tips"),s.find(".tips-register").text("两次密码不一致").fadeIn();else{var f={register:DES3.encrypt("b8a5483ed47744f7b4978104afdcc075",JSON.stringify({cellphone:n,password:a,code:d,referrer:r}))};e.fetchAjax(t.data+"/user/register",f).done(function(e){0===e.status||"0"===e.status?(console.log("注册成功，跳转中..."),Cookies.set("token",e.result&&e.result.token),Cookies.set("name",e.result&&e.result.name||n),Cookies.set("phone",n),Cookies.set("headImg",e.result&&e.result.headImg||""),location.href="/"):(i.getImgCode(),s.find(".code-input, .phone-code-input").val(""),s.find(".code-input").focus(),s.find(".tips-register").text(e.msg).fadeIn(),setTimeout(function(){s.find(".tips-register").text("").hide()},3500))}).fail(function(e){console.log(e)})}else s.find(".password").addClass("input-tips"),s.find(".tips-register").text("密码不能为空").fadeIn();else s.find(".phone-code-input").addClass("input-tips"),s.find(".tips-register").text("手机验证码不能为空").fadeIn();else s.find(".phone").addClass("input-tips"),s.find(".tips-register").text("手机号不能为空").fadeIn()}),$("body").keydown(function(e){"13"==e.keyCode&&$(".register-btn").click()})}};i.init()}();