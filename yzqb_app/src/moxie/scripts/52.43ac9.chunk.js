webpackJsonp([52],{236:function(e,t,a){try{(function(){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var l=a(2),r=n(l),i=a(96),o=(n(i),a(8)),s=a(14),u=n(s),d=a(1),f=a(40),p=a(4),c=n(p),m=a(53),h=n(m),g=a(13),y=n(g),v=a(5),E=n(v),k=a(10),C=n(k),b=a(11),_=(n(b),a(41)),P=n(_),w=r.default.createClass({displayName:"index",propTypes:{pageConfig:l.PropTypes.object.isRequired,inMemoryLogin:l.PropTypes.object,areaCode:l.PropTypes.string.isRequired},getInitialState:function(){return{loginTypeIndex:0,isStart:!1,officailUrl:null,registerUrl:null,forget_password_url:null,linkUrl:"",title:"",showConfirm:"none",frontConf:this.props.frontConf}},getDefaultProps:function(){return{auto:0,inMemoryLogin:null}},componentDidMount:function(){var e=this,t=this.props,a=t.pageConfig,n=(t.areaCode,(0,f.getParams)("loginParams"));if(n){var l=!1;a.fields.map(function(e,t){n[a.login_type]&&n[a.login_type][e.name]||(l=!0)}),l||(this.timer=setInterval(function(){var t=!1;a.fields.map(function(a,n){e.refs[a.name]||(t=!0)}),t||(clearInterval(e.timer),e.handleImport())},100))}var r=document.getElementsByClassName("security-bottom")[0],i=document.body.clientHeight;window.onresize=function(){document.body.clientHeight<i?r.style.display="none":r.style.display="flex"};var o=this.autoImport,s=this.props.inMemoryLogin;if(this.isMounted=!0,s&&s.loginType){for(var u=0,d=0;d<1;d++)if(a.login_type===s.loginType){u=d;break}this.setState({loginTypeIndex:u},o)}},componentWillUnmount:function(){this.isMounted=!1},showPwd:function(e,t){var n=h.default.findDOMNode(this.refs[e]).querySelector("input");"password"==n.type?(n.type="text",this.refs[e+"-span"].style.backgroundImage="url("+a(36)+")"):(n.type="password",this.refs[e+"-span"].style.backgroundImage="url("+a(20)+")")},clearVal:function(e){this.refs[e].setValue("")},render:function(){var e=this,t=this.handleImport,a=(this.handleProtocol,this.renderInputs),n=this.state.isStart,l=this.props.pageConfig,i=a(),o=({backgroundColor:"#"+d.qsParams.themeColor},r.default.createElement("div",{className:"config-import-page"},i.length>0?r.default.createElement("div",{className:"form common-form"},i):null,r.default.createElement("div",{className:"login-other-items",style:{overflow:"hidden"}},r.default.createElement(P.default,{ref:"agreementField-"+l.login_type,key:l.login_type,frontConf:this.state.frontConf}),this.props.forget_password_url?r.default.createElement(C.default,{onTap:function(){return e.handleLink(3)}},r.default.createElement("span",{style:{float:"right",fontSize:"12px",color:d.qsParams.themeColor?"#"+d.qsParams.themeColor:"#5e82fb",paddingRight:"10px"}},"忘记密码?")):null),r.default.createElement("div",{className:"page-wrapper"},r.default.createElement(C.default,{onTap:t},r.default.createElement(E.default,{types:"full",onTap:function(){},disable:n,state:n,getState:function(e){switch(e){case!1:return"提交";case!0:return"登录中...";default:return"提交"}}}))),r.default.createElement("div",null,r.default.createElement("div",{style:{color:d.qsParams.themeColor?"#"+d.qsParams.themeColor:"#5e82fb"},className:"link-wrapper"},this.props.registerUrl?r.default.createElement("div",{onClick:function(){return e.handleLink(1)}},r.default.createElement("span",{className:"ion-ios-redo-outline"}),r.default.createElement("a",{style:{color:d.qsParams.themeColor?"#"+d.qsParams.themeColor:"#5e82fb"}},"账号注册")):r.default.createElement("div",null),this.props.officailUrl?r.default.createElement("div",{onClick:function(){return e.handleLink(2)}},r.default.createElement("span",{className:"ion-ios-world"}),r.default.createElement("a",{style:{color:d.qsParams.themeColor?"#"+d.qsParams.themeColor:"#5e82fb"}},"前往官网")):r.default.createElement("div",null)),this.props.tips&&"null"!=this.props.tips?r.default.createElement("div",{style:{paddingLeft:"15px"},className:"tip"},r.default.createElement("div",null,"温馨提示:"),"*",this.props.tips):null,r.default.createElement("div",{className:"confirmBox",style:{display:this.state.showConfirm,maxWidth:d.qsParams.maxWidth?d.qsParams.maxWidth:"500px",right:0,margin:"auto"}},r.default.createElement("div",null,r.default.createElement("div",{style:{width:"100%",height:"40px",lineHeight:"60px",marginBottom:"20px",color:"#666"}},"确定要跳转吗？"),r.default.createElement("div",null,r.default.createElement(C.default,{onTap:function(){e.setState({showConfirm:"none"})}},r.default.createElement("span",null,"取消")),r.default.createElement(C.default,{onTap:function(){return e.linkUrlFun()}},r.default.createElement("span",{style:{color:d.qsParams.themeColor?"#"+d.qsParams.themeColor:"#58b5eb"}},"确定"))))))));return r.default.createElement("div",null,o)},linkUrlFun:function(){this.setState({showConfirm:"none"}),c.default.openWebView(this.state.title,this.state.linkUrl,"","")},handleLink:function(e){switch(this.setState({showConfirm:"block"}),e){case 1:this.setState({title:"注册账号",linkUrl:this.props.registerUrl});break;case 2:this.setState({title:"前往官网",linkUrl:this.props.officailUrl});break;case 3:this.setState({title:"忘记密码",linkUrl:this.props.forget_password_url})}},renderInputs:function(){var e=this,t=this.tryGetCachedValue,a=(this.wrapValidator,this.getKeyFromLoginParams,this.state.loginTypeIndex,this.props.pageConfig),n=a,l=!1,i=void 0;try{i=(0,f.getParams)("loginParams")?(0,f.getParams)("loginParams"):{},i[a.login_type]&&(l=!0)}catch(e){console.log(e)}return n.fields.map(function(n,o){var s=t(n.name);if("select"==n.type){for(var u=[],d=0;d<n.list.length;d++)u.push(r.default.createElement("option",{key:d,value:n.list[d].value},n.list[d].key));var f=r.default.createElement("select",{ref:""+n.name,defaultValue:n.list[0].value},u);return r.default.createElement("div",{className:"input-item",key:n.fieldId},n.label,r.default.createElement("span",{className:"input-select"},f),r.default.createElement("p",{className:"input-tip"},n.des))}return r.default.createElement("div",{className:"input-item",key:n.fieldId},r.default.createElement(y.default,{key:a.login_type+"-"+n.label,type:""+n.type,ref:""+n.name,id:"inp"+o,defaultValue:l&&i[a.login_type][n.name]?i[a.login_type][n.name]:s,name:n.label,placeholder:"请输入"+n.label,label:n.label}),r.default.createElement("p",{className:"input-tip"},n.des),r.default.createElement("div",{className:"tex_box"},r.default.createElement("span",{ref:n.name+"-span",onClick:"password"==n.name?function(){return e.showPwd(n.name)}:function(){return e.clearVal(n.name)},className:"password"==n.name?n.name:"textt"})))})},handleImport:function(){function e(){u.default.set("security",l,n.loginModel,n.login_type,{loginParam:s,loginFail:!0})}var t=this,a=(this.doneLogin,this.props),n=a.pageConfig,l=a.areaCode,r=a.onSubmitTaskDone;if(this.state.loginTypeIndex,!this.refs["agreementField-"+n.login_type].isChecked(_.AGREEMENT_TYPE.MOXIE))return void setTimeout(function(){return c.default.alert("请勾选同意《用户使用协议》","")});if(!this.refs["agreementField-"+n.login_type].isChecked(_.AGREEMENT_TYPE.TENANT))return void setTimeout(function(){return c.default.alert("请勾选同意《用户使用协议》","")});var i=n,s=i.fields.reduce(function(e,a){if("select"==a.type){var n=t.refs[""+a.name].value;0==a.required&&""==n||(e[""+a.name]=n)}else{var n=t.refs[""+a.name].getValue();0==a.required&&""==n||(e[""+a.name]=n)}return e},{});for(var d in s)if(""==s[d])return void setTimeout(function(){return c.default.alert("请填写完整的信息!","")});s.taskType="security",s.login_type=n.login_type,s.area_code=l,this.setState({isStart:!0}),(0,o.submitTaskHelper)(s).then(function(e){if(e.body.task_id){t.setState({isStart:!1}),c.default.refreshStatus("2","创建任务成功"),c.default.mxSaveTaskId(e.body.task_id);var a={taskId:e.body.task_id,account:s.account,real_name:s.real_name,id_card:s.id_card,loginModel:n.loginModel,loginType:n.login_type,taskType:"security"};u.default.set("security",l,n.loginModel,n.login_type,a),r(a)}}).catch(function(a){t.setState({isStart:!1}),console.log(a),c.default.refreshStatus("-3","服务异常，创建任务失败"),console.log("登录失败，标记失败"),e(),t.handleError(a)})},getLastLogin:function(){var e=this.props,t=e.pageConfig,a=e.areaCode;return u.default.get("security",a,t.loginModel,t.login_type)},handleError:function(e){var t=e&&e.body&&e.body.detail||"网络异常，请稍后再试!\n"+e;c.default.alert(t),this.setState({isStart:!1})},selectLoginType:function(e){this.state.isStart||this.setState({loginTypeIndex:e})},doneLogin:function(e){return e.importResult={},this.props.setTaskStore(e),this.props.onLoginDone(),!0},autoImport:function(){this.props.auto&&this.handleImport()},tryGetCachedValue:function(e){var t=this.props.inMemoryLogin,a=this.getLastLogin(),n="";return a&&(n=(0,d.testPassword)(e)?a.loginFail?null:"":a[e]),t&&t.loginParam&&t.loginParam[e]&&(n=t.loginParam[e]),n},handleJumpPage:function(){c.default.openWebView("个人社保",this.props.webUrl)},wrapValidator:function(e){return function(t){return""===t||new RegExp(e).test(t)}}});t.default=w,e.exports=t.default}).call(this)}finally{}}});