webpackJsonp([64],{227:function(e,t,a){try{(function(){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0});var o=a(2),r=n(o),l=a(96),s=(n(l),a(8)),i=a(14),u=n(i),d=a(1),p=a(53),c=n(p),f=a(4),m=n(f),g=a(10),h=n(g),y=a(13),v=n(y),b=a(5),P=n(b),E=a(11),T=(n(E),a(40)),C=r.default.createClass({displayName:"index",propTypes:{pageConfig:o.PropTypes.object.isRequired,inMemoryLogin:o.PropTypes.object,areaCode:o.PropTypes.string.isRequired},getInitialState:function(){return{loginTypeIndex:0,isStart:!1,frontConf:this.props.frontConf}},getDefaultProps:function(){return{auto:0,inMemoryLogin:null}},componentDidMount:function(){var e=this,t=this.props.pageConfig,a=(0,T.getParams)("loginParams");if(a){var n=!1;t.fields.map(function(e,o){a[t.login_type]&&a[t.login_type][e.name]||(n=!0)}),n||(this.timer=setInterval(function(){var a=!1;t.fields.map(function(t,n){e.refs[t.name]||(a=!0)}),a||(clearInterval(e.timer),e.handleImport())},100))}var o=document.getElementsByClassName("fund-bottom")[0],r=document.body.clientHeight;window.onresize=function(){document.body.clientHeight<r?o.style.display="none":o.style.display="flex"};var l=this.autoImport,s=this.props.inMemoryLogin;if(this.isMounted=!0,s&&s.loginType){for(var i=0,u=0;u<1;u++)if(t.login_type===s.loginType){i=u;break}this.setState({loginTypeIndex:i},l)}},componentWillUnmount:function(){this.isMounted=!1},render:function(){var e=this.handleImport,t=this.handleProtocol,a=this.renderInputs,n=this.state.isStart,o=this.props.pageConfig,l=void 0!=d.qsParams.agreementEntryText?d.qsParams.agreementEntryText:"同意《用户使用协议》",s=a(),i=({backgroundColor:"#"+d.qsParams.themeColor},r.default.createElement("div",{className:"config-import-page"},s.length>0?r.default.createElement("div",{className:"form common-form"},s):null,r.default.createElement("div",{style:{display:"NO"==d.qsParams.showAgreement||0==d.qsParams.showAgreement?"none":"block"},className:"protocol"},r.default.createElement("input",{id:"protocol"+o.login_type,ref:"protocol"+o.login_type,type:"checkbox",defaultChecked:!0}),r.default.createElement("label",{htmlFor:"protocol"+o.login_type},r.default.createElement("span",{style:{background:d.qsParams.themeColor?"#"+d.qsParams.themeColor:"rgb(126, 195, 235)"}})),r.default.createElement(h.default,{onTap:t},r.default.createElement("a",null,l))),d.qsParams.tenantAgreementUrl||this.state.frontConf.tenantAgreementUrl?r.default.createElement("div",{className:"protocol"},r.default.createElement("input",{id:"tanent_protocol"+o.login_type,ref:"tanent_protocol"+o.login_type,type:"checkbox",defaultChecked:!0}),r.default.createElement("label",{htmlFor:"tanent_protocol"+o.login_type},r.default.createElement("span",{style:{background:d.qsParams.themeColor?"#"+d.qsParams.themeColor:"rgb(126, 195, 235)"}})),r.default.createElement(h.default,{onTap:this.handleTanentProtocol},r.default.createElement("a",null,d.qsParams.tenantAgreementEntryText||this.state.frontConf.tenantAgreementEntryText||"同意《用户使用协议》"))):null,r.default.createElement("div",{className:"page-wrapper"},r.default.createElement(h.default,{onTap:e},r.default.createElement(P.default,{types:"full",onTap:function(){},disable:n,state:n,getState:function(e){switch(e){case!1:return"提交";case!0:return"登录中...";default:return"提交"}}})),this.props.tips&&"null"!=this.props.tips?r.default.createElement("div",{className:"tip"},r.default.createElement("div",null,"温馨提示:"),"*",this.props.tips):null)));return r.default.createElement("div",null,i)},showPwd:function(e,t){var n=c.default.findDOMNode(this.refs[e]).querySelector("input");"password"==n.type?(n.type="text",this.refs[e+"-span"].style.backgroundImage="url("+a(36)+")"):(n.type="password",this.refs[e+"-span"].style.backgroundImage="url("+a(20)+")")},clearVal:function(e){this.refs[e].setValue("")},renderInputs:function(){var e=this,t=this.tryGetCachedValue,a=(this.wrapValidator,this.state.loginTypeIndex,this.props.pageConfig),n=a,o=!1,l=void 0;try{l=(0,T.getParams)("loginParams")?(0,T.getParams)("loginParams"):{},l[a.login_type]&&(o=!0)}catch(e){console.log(e)}return n.fields.map(function(n,s){var i=t(n.name);if("select"==n.type){for(var u=[],d=0;d<n.list.length;d++)u.push(r.default.createElement("option",{key:d,value:n.list[d].value},n.list[d].key));var p=r.default.createElement("select",{ref:""+n.name,defaultValue:n.list[0].value},u);return r.default.createElement("div",{className:"input-item",key:n.fieldId},n.label,r.default.createElement("span",{className:"input-select"},p),r.default.createElement("p",{className:"input-tip"},n.des))}return r.default.createElement("div",{className:"input-item",key:n.fieldId},r.default.createElement(v.default,{key:a.login_type+"-"+n.label,type:""+n.type,ref:""+n.name,id:"inp"+s,defaultValue:o&&l[a.login_type][n.name]?l[a.login_type][n.name]:i,name:n.label,placeholder:"请输入"+n.label,label:n.label}),r.default.createElement("p",{className:"input-tip"},n.des),r.default.createElement("div",{className:"tex_box"},r.default.createElement("span",{ref:n.name+"-span",onClick:"password"==n.name?function(){return e.showPwd(n.name)}:function(){return e.clearVal(n.name)},className:"password"==n.name?n.name:"textt"})))})},handleImport:function(){function e(){u.default.set("fund",o,n.loginModel,n.login_type,{loginParam:i,loginFail:!0})}var t=this,a=(this.doneLogin,this.props),n=a.pageConfig,o=a.areaCode,r=a.onSubmitTaskDone,l=(this.state.loginTypeIndex,n);if(!document.getElementById("protocol"+n.login_type).checked)return void setTimeout(function(){return m.default.alert("请勾选同意《用户使用协议》","")});if(this.refs["tanent_protocol"+n.login_type]&&!this.refs["tanent_protocol"+n.login_type].checked)return void setTimeout(function(){return m.default.alert("请勾选同意《用户使用协议》","")});var i=l.fields.reduce(function(e,a){if("select"==a.type){var n=t.refs[""+a.name].value;0==a.required&&""==n||(e[""+a.name]=n)}else{var n=t.refs[""+a.name].getValue();0==a.required&&""==n||(e[""+a.name]=n)}return e},{});for(var d in i)if(""==i[d])return void setTimeout(function(){return m.default.alert("请填写完整的信息!","")});this.setState({isStart:!0}),(0,s.submitTaskHelper)({taskType:"fund",taskSubType:"",username:i.account,password:i.password,loginType:n.login_type,areaCode:o,idCard:i.idCard,realName:i.realName,loanAccount:i.loanAccount,loanPassWord:i.loanPassWord,corpAccount:i.corpAccount,corpName:i.corpName,mobile:i.mobile,subArea:i.subArea}).then(function(e){if(e.body.task_id){t.setState({isStart:!1}),m.default.refreshStatus("2","创建任务成功"),m.default.mxSaveTaskId(e.body.task_id);var a={taskId:e.body.task_id,bankId:o,username:i.account,loginModel:n.loginModel,loginType:n.login_type,taskType:"fund",loginParam:{account:i.account,idCard:i.idCard,realName:i.realName}};r(a)}}).catch(function(a){t.setState({isStart:!1}),console.log(a.body),m.default.refreshStatus("-3","服务异常，创建任务失败"),console.log("登录失败，标记失败"),e(),t.handleError(a)})},getLastLogin:function(){var e=this.props,t=e.pageConfig,a=e.areaCode;return u.default.get("fund",a,t.loginModel,t.login_type)},handleError:function(e){var t=e&&e.body&&e.body.detail||"网络异常，请稍后再试!\n"+e;m.default.alert(t),this.setState({isStart:!1})},handleTanentProtocol:function(){var e=d.qsParams.tenantAgreementUrl||this.state.frontConf.tenantAgreementUrl;m.default.openWebView("用户使用协议",e,"","agreement")},handleProtocol:function(){var e=d.qsParams.agreementUrl||this.state.frontConf.agreementUrl;m.default.openWebView("用户使用协议",e,"","agreement")},selectLoginType:function(e){this.state.isStart||this.setState({loginTypeIndex:e})},doneLogin:function(e){return e.importResult={},this.props.setTaskStore(e),this.props.onLoginDone(),!0},autoImport:function(){this.props.auto&&this.handleImport()},tryGetCachedValue:function(e){var t=this.props.inMemoryLogin,a=this.getLastLogin(),n="";return a&&a.loginParam&&(n=(0,d.testPassword)(e)?a.loginFail?null:"":a.loginParam[e]),t&&t.loginParam&&t.loginParam[e]&&(n=t.loginParam[e]),n},handleJumpPage:function(){m.default.openWebView("个人公积金",this.props.webUrl)},wrapValidator:function(e){return function(t){return""===t||new RegExp(e).test(t)}}});t.default=C,e.exports=t.default}).call(this)}finally{}}});