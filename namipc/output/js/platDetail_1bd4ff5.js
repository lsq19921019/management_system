!function(){var t=require("mod/tools"),e=t.apiUrl(),i={init:function(){i.getImgCode(),i.onClickEvent(),i.getDetailData(),i.countCalculator(),i.receipt()},getImgCode:function(){var i=$(".fillreceipt .yzm");t.fetchAjax(e.data+"/message/image_code").done(function(t){if(0===t.status||"0"===t.status){var e="data:image/png;base64,"+(t.result&&t.result.imgVal);i.find(".img-code").attr("src",e),i.find(".img-code").attr("data-imei",t.result&&t.result.imei)}})},isPoneAvailable:function(t){var e=/^[1][3,4,5,7,8][0-9]{9}$/;return e.test(t)?!0:!1},receipt:function(){var n=$(".fillreceipt");if(n.length){n.find(".yzm .img-code").on("click",function(){i.getImgCode()});{new Pikaday({field:$("#datePicker-time")[0],format:"YYYY-MM-DD",onSelect:function(){console.log(this.getMoment().format("YYYY-MM-DD"))}})}$(".fill-con .submit").on("click",function(){var n=$(".detail-in").find(".detail-tit span").data("pfno"),o=$(".fill-con"),a=o.find(".img-code").attr("data-imei"),l={pfNo:n||"",pfusername:o.find(".name").val()||"",phone:o.find(".user-phone").val()||"",projectid:o.find(".item-list-hbs").val()||"",investamount:o.find(".money").val()||"",investtime:o.find(".time").val()||"",code:o.find(".code").val()||"",propId:""};l.investamount?l.phone?i.isPoneAvailable(l.phone)?l.investtime?l.projectid?l.code?t.fetchAjax(e.data+"/assets/apply_invest_record",l,"post",{imei:a}).done(function(e){console.log(e),0==e.status?(i.getImgCode(),t.tipsAlert(e.msg||"申报成功！"),$(".platform-list-hbs").val(""),o.find(".code").val(""),setTimeout(function(){location.reload()},3e3)):(i.getImgCode(),t.tipsAlert(e.error||e.msg||"申报失败，请稍后重试",3e3))}):t.tipsAlert("请输入验证码"):t.tipsAlert("请选择标的名称"):t.tipsAlert("请选择投资时间"):t.tipsAlert("手机号码无效"):(t.tipsAlert("请输入注册手机号码"),o.find(".user-phone").focus()):(t.tipsAlert("请输入投资金额"),o.find(".money").focus())})}},onClickEvent:function(){var t=$(".platform-info"),e=t.find(".header");e.on("click","a",function(){var i=$(this),n=i.attr("data-tab");e.find("a").removeClass("active"),i.addClass("active"),t.find(".tab-content").hide(),t.find("."+n).show()}),$(document).on("click",".lianjie",function(){var t=Cookies.get("token")||"";t?($(".popout").css("display","block"),$("#cover").css("display","block")):location.href="/login.html"}),$(document).on("click",".close",function(){$(".popout").css("display","none"),$("#cover").css("display","none")}),$(document).on("click",".tijiao",function(){var t=Cookies.get("token")||"";t?($(".fillreceipt").css("display","block"),$("#cover").css("display","block")):location.href="/login.html"}),$(".fillreceipt").on("click",".close",function(){$(".fillreceipt").css("display","none"),$("#cover").css("display","none")})},countCalculator:function(){$(function(){$(".detail-section").find(".calculator .cal-btn").on("click",function(){var t=$(".calculator").find(".money-input").val(),e=$(".calculator").find(".percent-input").val()/100,i=$(".calculator").find(".time-input").val(),n=(t*e*i/360).toFixed(2);$(".calculator .profit-input").val(n)})})},getDetailData:function(){var i=t.getUrlParam("id"),n=t.getUrlParam("pfNo"),o={projectId:i,platformNo:n};t.fetchAjax(e.data+"/platform/detail",o).done(function(e){if(console.log(e),0==e.status){var i=e.result;i.pfcreatetime=new Date(i.pfcreatetime).toLocaleDateString(),t.renderTpl($(".platform-info .platform-content"),$("#platform-hbs-template"),i),$(".zhnh .mark-img").hover(function(){$(".zhnh .hint").css("display","block")},function(){$(".zhnh .hint").css("display","none")})}}),t.fetchAjax(e.data+"/finance/project_detail",o).done(function(i){if(console.log(i),0==i.status){var o=i.result;$(".investmentStrategy").html(o.investmentStrategy),$(".setion-tit").text(o.borrowTitle),"1"==o.objectRange||1==o.objectRange?$(".tz-img").attr("src","/img/ft-ico_5894266.png"):$(".tz-img").attr("src","/img/st-ico1_f11176a.png"),o.pfcreatetime=new Date(o.pfcreatetime).toLocaleDateString(),t.renderTpl($(".detail-section .detail-content .detail-in"),$("#detail-content-template"),o),t.fetchAjax(e.data+"/finance/platform_project_list_all",{platformNo:n}).done(function(e){if(0==e.status){var i=e.result&&e.result.list;t.renderTpl($(".fillreceipt .item-list-hbs"),$("#item-list-template"),{itemList:i}),$(".item-list-hbs").val(o.id)}})}})}};i.init()}();